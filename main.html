<html>
<head>
    <base href="https://www.poopprofit.com/index.html">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R1E17DCKNC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-R1E17DCKNC');
    </script>
    <title>How Much You Make to Poop!</title>
    <meta name="description" content="Have you ever wondered how much you make to poop at work?" />
    <meta name="keywords" content="poop tracker, earnings tracker, poop earnings, fun poop tracking, poop profit, profit calculator, work app, paid to poop, on the clock, poop at work, free money, work poop, poop on the job, poop earnings"/>
    <link rel="icon" href="https://www.poopprofit.com/favicon.png" type="image/png">

    <!-- Firebase setup -->
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "poopprofitproject.firebaseapp.com",
            projectId: "poopprofitproject",
            storageBucket: "poopprofitproject.appspot.com",
            messagingSenderId: "818996284466",
            appId: "1:818996284466:web:de6d6bab3987cca417c02b",
            measurementId: "G-JBXJ1T6LYM"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

    <style>
        /* All your styling here */
    </style>
</head>

<body>
    <div class="container">
        <h1 class="neon-text">Poop Profit Calculator</h1>
        <div class="card glow">
            <input type="number" id="salary" placeholder="Annual Salary">
            <input type="number" id="hoursPerWeek" placeholder="Weekly Work Hours">
            <div id="result"></div>
        </div>
        <div class="card glow">
            <div id="poopEmoji">ðŸ’©</div>
            <div id="timer" class="neon-text">00:00:00</div>
            <button id="startStopButton">Start Pooping</button>
            <button id="boredButton" style="display: none;">Bored?</button>
            <button id="stillBoredButton" style="display: none;">Still bored??</button>
        </div>
        <div class="card glow">
            <h2>Poop Log</h2>
            <div id="log">
                <div id="logEntries"></div>
            </div>
        </div>
        <button id="statsButton">Show Statistics</button>
        <button id="logoutButton">Logout</button>
    </div>

    <!-- Firebase Authentication and Data Handling -->
    <script>
        let currentUser = null;

        // Firebase Authentication Handling
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = 'signup.html';  // Redirect to signup page if not logged in
            } else {
                currentUser = user;
                await loadUserDataFromFirebase(user.uid);
            }
        });

        // Save User Data to Firebase
        async function saveUserData() {
            if (!currentUser) return;

            try {
                const userData = {
                    poopSessions: currentUser.data.poopSessions || [],
                    totalEarnings: currentUser.data.totalEarnings || 0,
                    salary: parseFloat(document.getElementById('salary').value) || 0,
                    hoursPerWeek: parseFloat(document.getElementById('hoursPerWeek').value) || 0
                };

                await db.collection('users').doc(currentUser.uid).set(userData, { merge: true });
                console.log("Data saved to Firebase");
            } catch (error) {
                console.error("Error saving data:", error);
            }
        }

        // Load User Data from Firebase
        async function loadUserDataFromFirebase(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    currentUser.data = userData;
                    document.getElementById('salary').value = userData.salary || 0;
                    document.getElementById('hoursPerWeek').value = userData.hoursPerWeek || 0;
                    updateLog();  // Update UI with saved poop sessions
                } else {
                    console.log("No user data found, initializing new user data");
                    currentUser.data = {
                        poopSessions: [],
                        totalEarnings: 0
                    };
                }
            } catch (error) {
                console.error("Error loading user data:", error);
            }
        }

        // Logout function
        function logout() {
            auth.signOut().then(() => {
                window.location.href = 'signup.html';  // Redirect after logout
            }).catch((error) => {
                console.error("Logout failed:", error);
            });
        }
    </script>

    <!-- Rest of your logic (e.g., timers, session logging) -->
    <script>
        let timer;
        let seconds = 0;
        let isRunning = false;
        let poopRating = 0;
        let lastSessionEarnings = 0;

        const salaryInput = document.getElementById('salary');
        const hoursPerWeekInput = document.getElementById('hoursPerWeek');
        const timerDiv = document.getElementById('timer');
        const startStopButton = document.getElementById('startStopButton');
        const logEntriesDiv = document.getElementById('logEntries');

        // Timer Logic
        function updateTimer() {
            seconds++;
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            timerDiv.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function startStopTimer() {
            if (isRunning) {
                clearInterval(timer);
                startStopButton.textContent = 'Start Pooping';
                const earnings = calculateEarnings(seconds);
                lastSessionEarnings = earnings;
                logPoopSession(seconds, earnings);
                resetTimer();
            } else {
                resetTimer();
                timer = setInterval(updateTimer, 1000);
                startStopButton.textContent = 'Stop Pooping';
            }
            isRunning = !isRunning;
        }

        function resetTimer() {
            clearInterval(timer);
            seconds = 0;
            timerDiv.textContent = '00:00:00';
        }

        // Log poop session
        async function logPoopSession(duration, earnings) {
            const now = new Date();
            const session = {
                date: now,
                duration: duration,
                earnings: earnings,
                rating: 0,
                comment: ''
            };

            currentUser.data.poopSessions.push(session);
            currentUser.data.totalEarnings += earnings;

            await saveUserData();  // Save to Firebase
            updateLog();  // Update UI
        }

        // Calculate earnings
        function calculateEarnings(seconds) {
            const salary = parseFloat(salaryInput.value);
            const hoursPerWeek = parseFloat(hoursPerWeekInput.value);
            if (isNaN(salary) || isNaN(hoursPerWeek)) {
                return 0;
            }
            const hourlyRate = salary / (hoursPerWeek * 52);
            return (hourlyRate / 3600) * seconds;
        }

        // Update log on the page
        function updateLog() {
            logEntriesDiv.innerHTML = '';
            currentUser.data.poopSessions.forEach((session, index) => {
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <button class="delete-btn" data-index="${index}">Ã—</button>
                    <div class="date">${new Date(session.date).toLocaleString()}</div>
                    <div class="details">
                        Duration: ${formatTime(session.duration)}<br>
                        Earnings: $${session.earnings.toFixed(2)}
                    </div>
                `;
                logEntriesDiv.appendChild(logEntry);
            });
        }

        // Format time
        function formatTime(totalSeconds) {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        // Event listeners
        startStopButton.addEventListener('click', startStopTimer);
        logoutButton.addEventListener('click', logout);

    </script>
</body>
</html>
