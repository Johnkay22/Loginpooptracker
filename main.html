<html>
<head>
  <base href="https://www.poopprofit.com/index.html">
  
  <!-- Google Tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-R1E17DCKNC"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-R1E17DCKNC');
  </script>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAVZEGrBqPtDWH4acfOmzLk5k323A7EB6o",
      authDomain: "poopprofitproject.firebaseapp.com",
      projectId: "poopprofitproject",
      storageBucket: "poopprofitproject.appspot.com",
      messagingSenderId: "818996284466",
      appId: "1:818996284466:web:de6d6bab3987cca417c02b",
      measurementId: "G-JBXJ1T6LYM"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    } else {
      firebase.app();
    }
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

  <title>How Much You Make to Poop!</title>
  <meta name="description" content="Have you ever wondered how much you make to poop at work?" />
  <meta name="keywords" content="poop tracker, earnings tracker, poop earnings, fun poop tracking, poop profit, profit calculator, work app, paid to poop, on the clock, poop at work, free money, work poop, poop on the job, poop earnings"/>
  <link rel="icon" href="https://www.poopprofit.com/favicon.png" type="image/png">
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Poop Profit Calculator!" />
  <meta name="twitter:description" content="Have you ever wondered how much you make to poop at work?" />
  <meta name="twitter:image" content="https://raw.githubusercontent.com/Johnkay22/Loginpooptracker/main/PPCImage.jpg" />
  <meta name="twitter:site" content="@YourTwitterHandle" />
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Poop Profit Calculator!" />
  <meta property="og:description" content="Have you ever wondered how much you make to poop at work?" />
  <meta property="og:url" content="https://www.poopprofit.com" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Poop Profit Calculator" />
  <meta property="og:image" content="https://raw.githubusercontent.com/Johnkay22/Loginpooptracker/main/PPCImage.jpg">

  <!-- Responsive Meta Tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Link to chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
  
<style>
    :root {
        --primary-color: #3498db;
        --secondary-color: #2ecc71;
        --background-color: #1a1a2e;
        --text-color: #e0e0e0;
        --card-background: #16213e;
        --accent-color: #f39c12;
    }

    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 0;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }

    h1, h2 {
        color: var(--primary-color);
        text-align: center;
        font-weight: 300;
        margin-bottom: 30px;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .card {
        background-color: var(--card-background);
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        padding: 30px;
        margin-bottom: 30px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    input {
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        border: none;
        border-bottom: 2px solid var(--primary-color);
        background-color: transparent;
        color: var(--text-color);
        font-size: 16px;
        transition: border-color 0.3s ease;
    }

    input:focus {
        outline: none;
        border-bottom-color: var(--secondary-color);
    }

    button {
        width: 100%;
        padding: 15px;
        margin: 15px 0;
        border: none;
        border-radius: 50px;
        background-color: var(--primary-color);
        color: white;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    button:hover {
        background-color: var(--secondary-color);
        transform: scale(1.05);
    }

    #timer {
        font-size: 72px;
        text-align: center;
        margin: 30px 0;
        color: var(--primary-color);
        font-weight: 300;
        text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
    }

    #poopEmoji {
        font-size: 72px;
        text-align: center;
        margin: 30px 0;
    }

    .wiggle {
        animation: wiggle 0.5s infinite;
    }

    @keyframes wiggle {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(5deg); }
        75% { transform: rotate(-5deg); }
        100% { transform: rotate(0deg); }
    }

    #log {
        max-height: 400px;
        overflow-y: auto;
    }

    .log-entry {
        background-color: rgba(255, 255, 255, 0.05);
        border-left: 4px solid var(--primary-color);
        padding: 20px;
        margin-bottom: 15px;
        position: relative;
        transition: all 0.3s ease;
        border-radius: 5px;
    }

    .log-entry:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .log-entry .delete-btn, .log-entry .share-btn {
        position: absolute;
        top: 10px;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .log-entry .delete-btn {
        right: 10px;
        background-color: var(--accent-color);
    }

    .log-entry .share-btn {
        right: 50px;
        background-color: var(--secondary-color);
    }

    .log-entry .delete-btn:hover, .log-entry .share-btn:hover {
        transform: scale(1.1);
    }

    .log-entry .date {
        font-weight: bold;
        color: var(--primary-color);
        margin-bottom: 10px;
    }

    .log-entry .details {
        color: var(--text-color);
        font-size: 14px;
    }

    .log-entry .rating {
        margin-top: 10px;
        color: var(--secondary-color);
    }

    .log-entry .comment {
        margin-top: 10px;
        font-style: italic;
        color: var(--text-color);
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.7);
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background-color: var(--card-background);
        margin: 10% auto;
        padding: 30px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        width: 70%;
        max-width: 500px;
        border-radius: 10px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: color 0.3s ease;
    }

    .close:hover,
    .close:focus {
        color: var(--text-color);
        text-decoration: none;
    }

    #statsChart {
        width: 100%;
        height: 300px;
    }

    #statsText {
        margin-top: 20px;
        font-size: 14px;
        line-height: 1.6;
    }

    .stats-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stats-item:last-child {
        border-bottom: none;
    }

    .stats-label {
        font-weight: bold;
        color: var(--primary-color);
    }

    .stats-value {
        color: var(--text-color);
    }

    #congratsMessage {
        text-align: center;
        font-size: 20px;
        color: var(--secondary-color);
        margin-bottom: 20px;
        font-weight: 500;
    }

    .share-buttons {
        display: flex;
        justify-content: space-around;
        margin-top: 20px;
    }

    .share-buttons button {
        width: 30%;
        padding: 10px;
        font-size: 14px;
    }

    .poop-rating {
        display: flex;
        justify-content: center;
        font-size: 28px;
        margin-bottom: 20px;
    }

    .poop-rating button {
        background: none;
        border: none;
        font-size: 28px;
        cursor: pointer;
        opacity: 0.5;
        transition: opacity 0.3s, transform 0.2s;
        padding: 0 8px;
    }

    .poop-rating button:hover,
    .poop-rating button.active {
        opacity: 1;
        transform: scale(1.2);
    }

    .poop-rating button.active {
        opacity: 1;
        transform: scale(1.2);
    }

    /* Glowing effect */
    .glow {
        box-shadow: 0 0 10px var(--primary-color),
                    0 0 20px var(--primary-color),
                    0 0 30px var(--primary-color);
    }

    /* Neon text effect */
    .neon-text {
        text-shadow: 0 0 5px var(--primary-color),
                     0 0 10px var(--primary-color),
                     0 0 15px var(--primary-color),
                     0 0 20px var(--primary-color);
    }

    /* Date range selector */
    #date-range {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    #date-range input[type="date"] {
        width: 40%;
        padding: 10px;
        border: 1px solid var(--primary-color);
        border-radius: 5px;
        background-color: var(--card-background);
        color: var(--text-color);
    }

    #date-range button {
        width: 15%;
        padding: 10px;
        font-size: 14px;
    }

    /* New button styles */
    #boredButton, #startGameButton, #trueButton, #falseButton, #stillBoredButton {
        margin-top: 10px;
        width: 100%;
        padding: 10px;
        font-size: 16px;
    }

    #factStatement {
        font-size: 18px;
        margin-bottom: 20px;
    }

    #scoreCard {
        margin-top: 20px;
        text-align: center;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .container {
            padding: 15px;
        }

        #timer {
            font-size: 60px;
        }

        .modal-content {
            width: 90%;
            padding: 20px;
        }

        #date-range {
            flex-direction: column;
        }

        #date-range input[type="date"] {
            width: 100%;
            margin-bottom: 10px;
        }

        #date-range button {
            width: 100%;
        }
    }

    #raceTrack {
        width: 100%;
        height: 400px;
        background-color: var(--card-background);
        position: relative;
        overflow: hidden;
        border-radius: 10px;
    }

    .lane {
        height: 20%;
        border-bottom: 1px solid var(--text-color);
        position: relative;
    }

    .lane-number {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
        font-weight: bold;
        color: var(--text-color);
    }

    .turd-option, .turd {
        width: 40px;
        height: 40px;
        font-size: 24px;
    }

    .turd-option {
        cursor: pointer;
        transition: transform 0.2s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .turd-option:hover {
        transform: scale(1.2);
    }

    .turd {
        position: absolute;
        left: 30px;
        top: 50%;
        transform: translateY(-50%);
        transition: left 0.1s linear;
    }

    .toilet {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 24px;
    }

    #finishLine {
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 5px;
        background-color: var(--accent-color);
    }

    #turdSelection {
        display: flex;
        justify-content: space-around;
        margin-bottom: 20px;
    }

    .selection-prompt {
        text-align: center;
        font-size: 24px;
        margin-bottom: 20px;
        color: var(--accent-color);
    }

    .turd-number {
        font-size: 16px;
        margin-top: 5px;
    }

    .selected {
        border: 2px solid var(--accent-color);
        border-radius: 50%;
        padding: 5px;
    }

    .popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: var(--card-background);
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        z-index: 1000;
        text-align: center;
        display: none;
        width: 80%;
        max-width: 400px;
    }

    .popup h2 {
        margin-top: 0;
        color: var(--primary-color);
        font-size: 28px;
        margin-bottom: 20px;
    }

    .popup-content {
        font-size: 24px;
        margin-bottom: 30px;
        line-height: 1.4;
    }

    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 999;
        display: none;
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
    <h1 class="neon-text">Poop Profit Calculator</h1>
    <div class="card glow">
      <input type="number" id="salary" placeholder="Annual Salary">
      <input type="number" id="hoursPerWeek" placeholder="Weekly Work Hours">
      <div id="result"></div>
    </div>
    <div class="card glow">
      <div id="poopEmoji">💩</div>
      <div id="timer" class="neon-text">00:00:00</div>
      <button id="startStopButton">Start Pooping</button>
      <button id="boredButton" style="display: none;">Bored?</button>
      <button id="stillBoredButton" style="display: none;">Still bored??</button>
    </div>
    <div class="card glow">
      <h2>Poop Log</h2>
      <div id="log">
        <div id="logEntries"></div>
      </div>
    </div>
    <button id="statsButton">Show Statistics</button>
    <button id="logoutButton">Logout</button>
  </div>

  <!-- Modals -->
  <div id="ratingModal" class="modal">
      <div class="modal-content">
          <span class="close">×</span>
          <h2>Rate Your Poop</h2>
          <div class="poop-rating">
              <button class="poop" data-rating="1">💩</button>
              <button class="poop" data-rating="2">💩</button>
              <button class="poop" data-rating="3">💩</button>
              <button class="poop" data-rating="4">💩</button>
              <button class="poop" data-rating="5">💩</button>
          </div>
          <input type="text" id="poopComment" placeholder="Add a comment (optional)">
          <button id="submitRating">Submit Rating</button>
      </div>
  </div>

  <div id="shareRatingModal" class="modal">
      <div class="modal-content">
          <span class="close">×</span>
          <h2>Share Your Poop Rating</h2>
          <p id="shareRatingMessage"></p>
          <div class="share-buttons">
              <button id="shareRatingTwitter">Share on Twitter</button>
              <button id="shareRatingFacebook">Share on Facebook</button>
              <button id="shareRatingSMS">Share via SMS</button>
          </div>
      </div>
  </div>

  <div id="statsModal" class="modal">
      <div class="modal-content">
          <span class="close">×</span>
          <h2>Your Poop Statistics</h2>
          <p style="text-align: center; margin-bottom: 10px;">Sort statistics by a custom date range:</p>
          <div id="date-range">
              <input type="date" id="startDate">
              <input type="date" id="endDate">
              <button id="applyDateRange">Apply</button>
          </div>
          <canvas id="statsChart"></canvas>
          <div id="statsText"></div>
          <div class="share-buttons">
              <button id="shareStatsTwitter">Share on Twitter</button>
              <button id="shareStatsFacebook">Share on Facebook</button>
              <button id="shareStatsSMS">Share via SMS</button>
          </div>
      </div>
  </div>

  <div id="shareModal" class="modal">
      <div class="modal-content">
          <span class="close">×</span>
          <h2>Share Your Poop</h2>
          <button id="shareEntryTwitter">Share on Twitter</button>
          <button id="shareEntryFacebook">Share on Facebook</button>
          <button id="shareEntrySMS">Share via SMS</button>
      </div>
  </div>

  <!-- Script Section -->
  <script>
    // Initialize current user data and sync with Firestore/localStorage
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || { email: null, data: { poopSessions: [], totalEarnings: 0 } };

    // Firebase authentication listener
    auth.onAuthStateChanged((user) => {
      if (user) {
        fetchUserData(user);
      } else {
        window.location.href = 'signup.html';
      }
    });

    // Fetch and sync user data from Firestore
    function fetchUserData(user) {
      const userDocRef = db.collection('users').doc(user.uid);

      userDocRef.get().then((doc) => {
        if (doc.exists) {
          const userData = doc.data();

          // Sync data with localStorage
          currentUser = {
            email: user.email,
            data: userData.poopSessions || [],
            salary: userData.salary || '',
            hoursPerWeek: userData.hoursPerWeek || '',
            totalEarnings: userData.totalEarnings || 0
          };

          // Save data in localStorage
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          updateLog();
          updateHourlyRate();
        } else {
          console.error("No user data found in Firestore.");
        }
      }).catch((error) => {
        console.error("Error fetching user data from Firestore:", error);
      });
    }

 // Save user data both locally and to Firestore
    function saveUserData() {
      const accounts = JSON.parse(localStorage.getItem('poopTimerAccounts')) || {};
      if (accounts[currentUser.email]) {
        const savedPassword = accounts[currentUser.email].password; // Preserve the password
        accounts[currentUser.email].data = currentUser.data; // Update only the data field
        accounts[currentUser.email].password = savedPassword; // Restore the password
      }

      // Save data to localStorage
      localStorage.setItem('poopTimerAccounts', JSON.stringify(accounts));
      localStorage.setItem('currentUser', JSON.stringify(currentUser));

      // Also save to Firestore if user is authenticated
      const user = auth.currentUser;
      if (user) {
        db.collection('users').doc(user.uid).set({
          salary: currentUser.salary,
          hoursPerWeek: currentUser.hoursPerWeek,
          poopSessions: currentUser.data.poopSessions,
          totalEarnings: currentUser.data.totalEarnings
        }, { merge: true }).then(() => {
          console.log("User data successfully saved to Firestore.");
        }).catch((error) => {
          console.error("Error saving data to Firestore: ", error);
        });
      }
    }

    // Variables and timer setup
    let timer;
    let seconds = 0;
    let isRunning = false;
    let poopRating = 0;
    let lastSessionEarnings = 0;
    let statsChart = null;

    const salaryInput = document.getElementById('salary');
    const hoursPerWeekInput = document.getElementById('hoursPerWeek');
    const resultDiv = document.getElementById('result');
    const timerDiv = document.getElementById('timer');
    const startStopButton = document.getElementById('startStopButton');
    const logEntriesDiv = document.getElementById('logEntries');
    const statsButton = document.getElementById('statsButton');
    const poopEmoji = document.getElementById('poopEmoji');
    const logoutButton = document.getElementById('logoutButton');

    // Save salary and hours to localStorage
    function saveSalaryAndHours() {
      const salary = salaryInput.value;
      const hoursPerWeek = hoursPerWeekInput.value;
      if (currentUser) {
        currentUser.salary = salary;
        currentUser.hoursPerWeek = hoursPerWeek;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
      }
    }

    // Calculate and update hourly rate
    function updateHourlyRate() {
      const salary = parseFloat(salaryInput.value);
      const hoursPerWeek = parseFloat(hoursPerWeekInput.value);
      if (isNaN(salary) || isNaN(hoursPerWeek)) {
        resultDiv.textContent = 'Please enter valid numbers.';
        return;
      }
      const hourlyRate = salary / (hoursPerWeek * 52);
      resultDiv.textContent = `Your hourly rate is: $${hourlyRate.toFixed(2)}`;
    }

    salaryInput.addEventListener('input', () => {
      updateHourlyRate();
      saveSalaryAndHours();
    });

    hoursPerWeekInput.addEventListener('input', () => {
      updateHourlyRate();
      saveSalaryAndHours();
    });

    // Start/stop the poop timer
    function startStopTimer() {
      if (isRunning) {
        clearInterval(timer);
        startStopButton.textContent = 'Start Pooping';
        poopEmoji.classList.remove('wiggle');
        const earnings = calculateEarnings(seconds);
        lastSessionEarnings = earnings;
        logPoopSession(seconds, earnings);
        showRatingModal(earnings);
        resetTimer();
        document.getElementById('boredButton').style.display = 'none';
        document.getElementById('stillBoredButton').style.display = 'none';
      } else {
        resetTimer();
        timer = setInterval(updateTimer, 1000);
        startStopButton.textContent = 'Stop Pooping';
        poopEmoji.classList.add('wiggle');
        document.getElementById('boredButton').style.display = 'block';
        document.getElementById('stillBoredButton').style.display = 'none';
      }
      isRunning = !isRunning;
    }

    // Reset the timer
    function resetTimer() {
      clearInterval(timer);
      seconds = 0;
      timerDiv.textContent = '00:00:00';
    }

    // Update the timer display
    function updateTimer() {
      seconds++;
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      timerDiv.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    // Calculate earnings from poop session duration
    function calculateEarnings(seconds) {
      const salary = parseFloat(salaryInput.value);
      const hoursPerWeek = parseFloat(hoursPerWeekInput.value);
      if (isNaN(salary) || isNaN(hoursPerWeek)) {
        return 0;
      }
      const hourlyRate = salary / (hoursPerWeek * 52);
      return (hourlyRate / 3600) * seconds;
    }

    // Log the poop session data
    function logPoopSession(duration, earnings) {
      const now = new Date();
      const session = {
        date: now,
        duration: duration,
        earnings: earnings,
        rating: 0,
        comment: ''
      };

      if (!currentUser.data.poopSessions) {
        currentUser.data.poopSessions = [];
      }
      currentUser.data.poopSessions.push(session);
      currentUser.data.totalEarnings += earnings;

      updateLog();
      saveUserData();
    }

    // Format the session time display
    function formatTime(totalSeconds) {
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Update the poop log
    function updateLog() {
      logEntriesDiv.innerHTML = '';
      currentUser.data.poopSessions.forEach((session, index) => {
        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry';
        logEntry.innerHTML = `
          <button class="delete-btn" data-index="${index}">×</button>
          <button class="share-btn" data-index="${index}">📤</button>
          <div class="date">${new Date(session.date).toLocaleString()}</div>
          <div class="details">
            Duration: ${formatTime(session.duration)}<br>
            Earnings: $${session.earnings.toFixed(2)}
          </div>
          ${session.rating ? `<div class="rating">${'💩'.repeat(session.rating)}</div>` : ''}
          ${session.comment ? `<div class="comment">${session.comment}</div>` : ''}
        `;
        logEntriesDiv.appendChild(logEntry);
      });

      // Add event listeners for delete and share buttons
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = this.getAttribute('data-index');
          if (confirm('Are you sure you want to delete this log entry?')) {
            deleteLogEntry(index);
          }
        });
      });

      document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = this.getAttribute('data-index');
          showShareModal(index);
        });
      });
    }

    // Delete a poop log entry
    function deleteLogEntry(index) {
      currentUser.data.poopSessions.splice(index, 1);
      updateLog();
      saveUserData();
    }

    // Show the poop rating modal
    function showRatingModal(earnings) {
      const congratsMessage = document.getElementById('congratsMessage');
      congratsMessage.textContent = `Congratulations! You just earned $${earnings.toFixed(2)} while pooping!`;
      ratingModal.style.display = 'block';
      poopRating = 0;
      poopButtons.forEach(button => {
        button.classList.remove('active');
        button.style.opacity = '0.5';
      });
      document.getElementById('poopComment').value = '';
    }

    // Handle rating submission
    function submitRating() {
      const comment = document.getElementById('poopComment').value;
      const lastSessionIndex = currentUser.data.poopSessions.length - 1;
      currentUser.data.poopSessions[lastSessionIndex].rating = poopRating;
      currentUser.data.poopSessions[lastSessionIndex].comment = comment;
      saveUserData();
      ratingModal.style.display = 'none';
      updateLog();
      showShareRatingModal();
    }

    const poopButtons = document.querySelectorAll('.poop');
    poopButtons.forEach(button => {
      button.addEventListener('click', function() {
        poopRating = parseInt(this.getAttribute('data-rating'));
        poopButtons.forEach((btn, index) => {
          if (index < poopRating) {
            btn.classList.add('active');
            btn.style.opacity = '1';
          } else {
            btn.classList.remove('active');
            btn.style.opacity = '0.5';
          }
        });
      });
    });

    // Show the poop rating share modal
    function showShareRatingModal() {
      const shareRatingMessage = document.getElementById('shareRatingMessage');
      shareRatingMessage.textContent = `You rated your poop ${poopRating} out of 5 💩 and earned $${lastSessionEarnings.toFixed(2)}!`;
      shareRatingModal.style.display = 'block';
    }

    // Function to show the Share modal for a specific poop log entry
    function showShareModal(index) {
      currentShareIndex = index;
      shareModal.style.display = 'block';
    }

    // Close modals on click of close buttons
    const closeButtons = document.querySelectorAll('.close');
    closeButtons.forEach(button => {
      button.addEventListener('click', function() {
        this.closest('.modal').style.display = 'none';
      });
    });

    // Logout the user
    function logout() {
      auth.signOut().then(() => {
        // Clear localStorage after logging out
        localStorage.removeItem('currentUser');
        window.location.href = 'signup.html'; // Redirect to the signup page
      }).catch((error) => {
        console.error("Error logging out: ", error);
      });
    }

    // Event listeners for button interactions
    document.getElementById('submitRating').addEventListener('click', submitRating);
    document.getElementById('startStopButton').addEventListener('click', startStopTimer);
    document.getElementById('statsButton').addEventListener('click', showStats);
    document.getElementById('logoutButton').addEventListener('click', logout);

    // Function to handle statistics display
    function showStats() {
      statsModal.style.display = 'block';
      updateStats();
    }

    // Function to update and show statistics
    function updateStats(startDate = null, endDate = null) {
      let filteredSessions = currentUser.data.poopSessions;
      
      if (startDate && endDate) {
        filteredSessions = filteredSessions.filter(session => {
          const sessionDate = new Date(session.date);
          return sessionDate >= startDate && sessionDate <= endDate;
        });
      }

      if (filteredSessions.length === 0) {
        alert('No poop sessions recorded in the selected date range!');
        return;
      }

      const totalDuration = filteredSessions.reduce((sum, session) => sum + session.duration, 0);
      const averageTime = totalDuration / filteredSessions.length;
      const totalEarnings = filteredSessions.reduce((sum, session) => sum + session.earnings, 0);
      const averageEarnings = totalEarnings / filteredSessions.length;

      const msPerDay = 24 * 60 * 60 * 1000;
      const firstDay = new Date(filteredSessions[0].date).setHours(0, 0, 0, 0);
      const lastDay = new Date(filteredSessions[filteredSessions.length - 1].date).setHours(23, 59, 59, 999);
      const daysDifference = Math.max(1, (lastDay - firstDay) / msPerDay);
      const avgSessionsPerDay = filteredSessions.length / daysDifference;

      const statsText = `
        <div class="stats-item">
          <span class="stats-label">Total poops:</span>
          <span class="stats-value">${filteredSessions.length}</span>
        </div>
        <div class="stats-item">
          <span class="stats-label">Total poop time:</span>
          <span class="stats-value">${formatTime(totalDuration)}</span>
        </div>
        <div class="stats-item">
          <span class="stats-label">Total earnings:</span>
          <span class="stats-value">$${totalEarnings.toFixed(2)}</span>
        </div>
        <div class="stats-item">
          <span class="stats-label">Average poop time:</span>
          <span class="stats-value">${formatTime(Math.round(averageTime))}</span>
        </div>
        <div class="stats-item">
          <span class="stats-label">Average earnings per poop:</span>
          <span class="stats-value">$${averageEarnings.toFixed(2)}</span>
        </div>
        <div class="stats-item">
          <span class="stats-label">Average poops per day:</span>
          <span class="stats-value">${avgSessionsPerDay.toFixed(2)}</span>
        </div>
      `;

      document.getElementById('statsText').innerHTML = statsText;

      // Update chart
      updateStatsChart(averageTime / 60, averageEarnings, avgSessionsPerDay);
    }

    // Update statistics chart with new data
    function updateStatsChart(avgTime, avgEarnings, avgPoopsPerDay) {
      const ctx = document.getElementById('statsChart').getContext('2d');
      
      if (statsChart) {
        statsChart.destroy();
      }

      statsChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Avg Time (min)', 'Avg Earnings ($)', 'Avg Poops/Day'],
          datasets: [{
            label: 'Poop Statistics',
            data: [avgTime, avgEarnings, avgPoopsPerDay],
            backgroundColor: [
              'rgba(52, 152, 219, 0.6)',
              'rgba(46, 204, 113, 0.6)',
              'rgba(243, 156, 18, 0.6)'
            ],
            borderColor: [
              'rgba(52, 152, 219, 1)',
              'rgba(46, 204, 113, 1)',
              'rgba(243, 156, 18, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            },
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          },
          plugins: {
            legend: {
              labels: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          }
        }
      });
    }

    // Initialize the date inputs for the statistics modal
    function initializeDateInputs() {
      if (currentUser.data.poopSessions.length > 0) {
        const firstSession = new Date(currentUser.data.poopSessions[0].date);
        const lastSession = new Date(currentUser.data.poopSessions[currentUser.data.poopSessions.length - 1].date);
        
        document.getElementById('startDate').value = firstSession.toISOString().split('T')[0];
        document.getElementById('endDate').value = lastSession.toISOString().split('T')[0];
      }
    }

    document.getElementById('applyDateRange').addEventListener('click', () => {
      const startDate = new Date(document.getElementById('startDate').value);
      const endDate = new Date(document.getElementById('endDate').value);

      if (startDate > endDate) {
        alert('Start date must be before or equal to the end date.');
        return;
      }

      endDate.setHours(23, 59, 59, 999); // Set end of day for the end date
      updateStats(startDate, endDate);
    });

    // Initialize hourly rate and log display
    if (currentUser) {
      updateHourlyRate();
      updateLog();
      initializeDateInputs();
    }
  </script>
</body>
</html>

