<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Welcome to Your Dashboard. Enjoy Your Poop.</title>
  <meta name="description" content="Calculate how much you get paid to poop. Log sessions, track stats, share, and earn Turd Tokens." />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link rel="canonical" href="https://www.poopprofit.com" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{--primary:#1a1a2e;--secondary:#16213e;--accent:#0f3460;--text:#00CED1;--light:#f1f1f1;--neon:#3498db}
    body{min-height:100vh;margin:0;display:flex;flex-direction:column;color:var(--light);
      background:#000 url('https://www.poopprofit.com/MAINDESKTOPBG.jpeg') center/cover fixed no-repeat}
    *{box-sizing:border-box;font-family:Roboto,Arial,Helvetica,sans-serif}
    .app-container{background:rgba(26,26,46,.85);border-radius:10px;padding:20px;max-width:1100px;width:100%;margin:0 auto}
    header img{width:100%;display:block;border-radius:10px}
    .turd-token-balance{position:fixed;top:16px;right:12px;z-index:1000;padding:10px 12px;background:rgba(22,33,62,.9);border-radius:10px;display:flex;gap:6px;align-items:center;cursor:pointer}
    main{flex:1}
    .tabs{display:flex;gap:8px;justify-content:space-evenly;background:rgba(22,33,62,.9);border-radius:10px 10px 0 0;padding:12px}
    .tab{border:0;background:transparent;color:var(--light);padding:10px 12px;border-bottom:4px solid transparent;cursor:pointer}
    .tab.active{border-bottom-color:var(--neon)}
    .tab-content{display:none;background:rgba(26,26,46,.95);border-radius:0 0 10px 10px;padding:16px}
    .tab-content.active{display:block}
    .card{background:rgba(22,33,62,.8);border-radius:10px;padding:16px;margin-bottom:16px}
    .row{display:grid;gap:16px}
    .row.cols-2{grid-template-columns:1fr 1fr}
    @media(max-width:800px){.row.cols-2{grid-template-columns:1fr}}
    .input-group{display:flex;flex-direction:column;gap:6px}
    .input-field{padding:10px;border:1px solid var(--accent);border-radius:6px;background:var(--secondary);color:var(--light)}
    .error{color:#ff4d4d;font-size:.85rem;display:none}
    .center{text-align:center}
    .poop-emoji{font-size:42px}
    .timer-display{font-size:42px;font-weight:700;color:var(--text)}
    .timer-button{padding:12px 18px;border:0;border-radius:36px;background:var(--neon);color:#fff;cursor:pointer}
    .log-entry{background:var(--secondary);border-radius:10px;padding:10px;margin-bottom:10px;position:relative}
    .delete-button{position:absolute;top:6px;right:6px;width:24px;height:24px;border-radius:50%;border:0;background:#ff4d4d;color:#fff;cursor:pointer}
    .stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
    .stat-card{background:linear-gradient(145deg, rgba(22,33,62,.9), rgba(15,52,96,.9));border:1px solid rgba(255,255,255,.1);border-radius:10px;padding:12px;text-align:center}
    .share-statistics{display:flex;gap:16px;justify-content:center;margin-top:12px}
    .share-button{width:64px;height:64px;border-radius:50%;border:0;background:var(--secondary);cursor:pointer;display:flex;align-items:center;justify-content:center}
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000}
    .modal .modal-content{background:var(--secondary);border:1px solid var(--accent);border-radius:10px;max-width:360px;margin:12% auto;padding:16px}
    .confirm-dialog{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000}
    .confirm-dialog-content{background:var(--secondary);border:1px solid var(--accent);border-radius:10px;max-width:300px;margin:12% auto;padding:16px;text-align:center}
    .logout-btn{position:fixed;bottom:16px;right:16px;padding:10px 14px;border:1px solid rgba(52,152,219,.3);border-radius:8px;background:linear-gradient(145deg,var(--secondary),var(--accent));color:#fff;cursor:pointer;z-index:1000}
    .token-award{color:#4CAF50;font-weight:700;margin-top:8px}
  </style>
</head>
<body>
  <div class="turd-token-balance" id="tokenWalletBtn" title="Turd Token Wallet">
    <img src="https://www.poopprofit.com/Turdtoken.png" alt="TT" style="width:28px;height:28px" />
    <span>TT: 0</span>
  </div>

  <div class="app-container">
    <header>
      <img src="https://www.poopprofit.com/header.png" alt="Header" />
    </header>

    <main>
      <div class="tabs">
        <button class="tab active" data-tab="calculator">Calculator</button>
        <button class="tab" data-tab="stats">Stats</button>
        <button class="tab" data-tab="games">Games</button>
      </div>

      <section id="calculator" class="tab-content active">
        <div class="card">
          <h2 class="center">Earnings Calculator</h2>
          <div class="row cols-2">
            <div class="input-group">
              <label><input type="checkbox" id="wageToggle" /> I know my hourly wage</label>
              <div id="salaryInputs">
                <label class="input-group">Annual salary
                  <input id="annualSalary" class="input-field" type="number" min="0" step="0.01" />
                  <small id="salaryError" class="error"></small>
                </label>
                <label class="input-group">Weekly hours
                  <input id="weeklyHours" class="input-field" type="number" min="0" step="0.1" />
                  <small id="hoursError" class="error"></small>
                </label>
              </div>
              <div id="hourlyInputs" style="display:none">
                <label class="input-group">Hourly wage
                  <input id="hourlyWageField" class="input-field" type="number" min="0" step="0.01" />
                  <small id="hourlyWageError" class="error"></small>
                </label>
              </div>
              <div id="hourlyWage" class="center" aria-live="polite">Your hourly wage: $0.00</div>
            </div>

            <div class="center">
              <div class="poop-emoji" id="poopEmoji">üí©</div>
              <div class="timer-display" id="timerDisplay">00:00:00</div>
              <button class="timer-button" id="timerButton">Start Pooping</button>
              <div id="earningsDisplay" class="center" style="margin-top:8px;font-weight:700;color:var(--text)"></div>
              <div id="awardContainer" class="token-award"></div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="center">Poop Log</h3>
          <div id="poopLogPlaceholder" class="center" style="opacity:.8">No logs yet</div>
          <div id="poopLog" aria-live="polite"></div>
        </div>
      </section>

      <section id="stats" class="tab-content">
        <div id="statisticsSection" class="card">
          <div class="stat-grid">
            <div class="stat-card"><p id="totalSessions">0</p><span>Total Sessions</span></div>
            <div class="stat-card"><p id="totalTime">00:00:00</p><span>Total Time</span></div>
            <div class="stat-card"><p>$<span id="totalEarnings">0.00</span></p><span>Total Earnings</span></div>
            <div class="stat-card"><p id="avgPoopTime">00:00:00</p><span>Avg Time/Session</span></div>
            <div class="stat-card"><p>$<span id="avgEarnings">0.00</span></p><span>Avg Earnings</span></div>
            <div class="stat-card"><p id="avgPoopsPerDay">0.00</p><span>Avg Poops/Day</span></div>
          </div>
          <canvas id="statsChart" height="260"></canvas>
          <div class="share-statistics">
            <button class="share-button" title="Share on X" id="shareStatsX">üïäÔ∏è</button>
            <button class="share-button" title="Share on Facebook" id="shareStatsFB">f</button>
            <button class="share-button" title="Share via SMS" id="shareStatsSMS">‚úâÔ∏è</button>
          </div>
        </div>

        <div class="card">
          <h3>Date range filter</h3>
          <div class="row cols-2">
            <div>
              <label class="input-group">Start date
                <input id="startDate" type="date" class="input-field" />
              </label>
            </div>
            <div>
              <label class="input-group">End date
                <input id="endDate" type="date" class="input-field" />
              </label>
            </div>
          </div>
          <div class="center" style="margin-top:8px">
            <button id="filterStats" class="timer-button" style="border-radius:6px">Apply</button>
            <button id="resetStats" class="timer-button" style="border-radius:6px;background:#e74c3c">Reset</button>
          </div>
        </div>
      </section>

      <section id="games" class="tab-content">
        <div class="card center">
          <p>Games are coming soon. You have demo tokens to play previews.</p>
        </div>
      </section>
    </main>
  </div>

  <!-- Rating modal -->
  <div id="ratingModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="rateTitle">
    <div class="modal-content">
      <h2 id="rateTitle" class="center">Rate Your Poop Session</h2>
      <div class="center" style="font-size:28px" id="emojiRow">
        <span class="poopEmoji" data-rating="1">üí©</span>
        <span class="poopEmoji" data-rating="2">üí©</span>
        <span class="poopEmoji" data-rating="3">üí©</span>
        <span class="poopEmoji" data-rating="4">üí©</span>
        <span class="poopEmoji" data-rating="5">üí©</span>
      </div>
      <div class="center"><button id="submitRatingButton" class="timer-button" style="border-radius:6px">Submit Rating</button></div>
    </div>
  </div>

  <!-- Share modal -->
  <div id="shareModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="shareTitle">
    <div class="modal-content">
      <h2 id="shareTitle" class="center">Share Your Earnings</h2>
      <div class="center" style="display:flex;gap:8px;justify-content:center">
        <button id="twitterShareButton" class="timer-button" style="border-radius:6px">Share on X</button>
        <button id="facebookShareButton" class="timer-button" style="border-radius:6px">Facebook</button>
        <button id="smsShareButton" class="timer-button" style="border-radius:6px">SMS</button>
      </div>
    </div>
  </div>

  <!-- Confirm delete dialog -->
  <div class="confirm-dialog" id="confirmDialog" role="dialog" aria-modal="true">
    <div class="confirm-dialog-content">
      <p>Delete this log entry</p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:8px">
        <button class="timer-button" id="confirmYes" style="background:#ff4d4d;border-radius:6px">Yes, delete</button>
        <button class="timer-button" id="confirmNo" style="border-radius:6px">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Wallet modal -->
  <div id="turdTokenWallet" class="modal" role="dialog" aria-modal="true" aria-labelledby="walletTitle">
    <div class="modal-content">
      <h2 id="walletTitle" class="center">Turd Token Wallet</h2>
      <div class="center" style="margin:10px 0">
        <img src="https://www.poopprofit.com/Turdtoken.png" alt="Turd Token" style="width:64px;height:64px" />
        <p>Balance: <span id="walletBalance">0</span> TT</p>
      </div>
      <p class="center" style="opacity:.8">Coming soon</p>
    </div>
  </div>

  <button class="logout-btn" id="logoutBtn">Logout</button>

  <script>
    // ===== State =====
    let hourlyWage = 0;
    let stats = { totalSessions:0, totalPoopTime:0, totalEarnings:0, firstSessionDate:null, lastSessionDate:null };
    let turdTokens = 0;
    let lastAwardDate = null;

    let timerInterval = null;
    let seconds = 0;
    let isTimerRunning = false;
    let selectedRating = 0;
    let pendingLogEntryEl = null; // last created entry awaiting rating

    // ===== DOM =====
    const wageToggle = document.getElementById('wageToggle');
    const annualSalaryInput = document.getElementById('annualSalary');
    const weeklyHoursInput = document.getElementById('weeklyHours');
    const hourlyWageField = document.getElementById('hourlyWageField');
    const hourlyWageDisplay = document.getElementById('hourlyWage');

    const salaryInputs = document.getElementById('salaryInputs');
    const hourlyInputs = document.getElementById('hourlyInputs');

    const timerButton = document.getElementById('timerButton');
    const timerDisplay = document.getElementById('timerDisplay');
    const earningsDisplay = document.getElementById('earningsDisplay');
    const poopEmoji = document.getElementById('poopEmoji');
    const poopLog = document.getElementById('poopLog');
    const poopLogPlaceholder = document.getElementById('poopLogPlaceholder');
    const awardContainer = document.getElementById('awardContainer');

    const ratingModal = document.getElementById('ratingModal');
    const shareModal = document.getElementById('shareModal');
    const tokenWallet = document.getElementById('turdTokenWallet');
    const tokenWalletBtn = document.getElementById('tokenWalletBtn');
    const walletBalance = document.getElementById('walletBalance');

    const confirmDialog = document.getElementById('confirmDialog');
    const confirmYes = document.getElementById('confirmYes');
    const confirmNo = document.getElementById('confirmNo');

    const shareStatsX = document.getElementById('shareStatsX');
    const shareStatsFB = document.getElementById('shareStatsFB');
    const shareStatsSMS = document.getElementById('shareStatsSMS');

    // Tabs
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(s=>s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // ===== Auth gate =====
    function getUsers(){ try{return JSON.parse(localStorage.getItem('users')||'{}')}catch(e){return{}} }
    function getCurrentUser(){ try{return JSON.parse(localStorage.getItem('currentUser')||'null')}catch(e){return null} }

    function requireLogin(){
      if(!getCurrentUser()){ window.location.href = 'index.html'; }
    }

    // ===== Load & Save =====
    function saveUserData(){
      const cu = getCurrentUser();
      if(!cu) return;
      const users = getUsers();
      cu.data = {
        hourlyWage,
        annualSalary: annualSalaryInput.value,
        weeklyHours: weeklyHoursInput.value,
        hourlyWageInput: hourlyWageField.value,
        wageToggle: wageToggle.checked,
        stats,
        turdTokens,
        lastAwardDate,
        poopLogs: Array.from(poopLog.children).map(el=>el.outerHTML)
      };
      localStorage.setItem('currentUser', JSON.stringify(cu));
      if(users[cu.email]){ users[cu.email].data = cu.data; localStorage.setItem('users', JSON.stringify(users)); }
      updateTurdTokenDisplay();
    }

    function loadUserData(){
      const cu = getCurrentUser();
      if(!cu) return;
      const d = cu.data || {};
      hourlyWage = d.hourlyWage || 0;
      annualSalaryInput.value = d.annualSalary || '';
      weeklyHoursInput.value = d.weeklyHours || '';
      hourlyWageField.value = d.hourlyWageInput || '';
      wageToggle.checked = !!d.wageToggle;
      stats = Object.assign({ totalSessions:0,totalPoopTime:0,totalEarnings:0,firstSessionDate:null,lastSessionDate:null }, d.stats || {});
      turdTokens = d.turdTokens || 0;
      lastAwardDate = d.lastAwardDate || null;
      walletBalance.textContent = turdTokens;
      hourlyInputs.style.display = wageToggle.checked ? '' : 'none';
      salaryInputs.style.display = wageToggle.checked ? 'none' : '';

      poopLog.innerHTML = '';
      if(Array.isArray(d.poopLogs) && d.poopLogs.length){
        poopLogPlaceholder.style.display = 'none';
        d.poopLogs.forEach(html=>{
          const div = document.createElement('div');
          div.innerHTML = html;
          const el = div.firstElementChild;
          wireDeleteButton(el);
          poopLog.appendChild(el);
        });
      }else{
        poopLogPlaceholder.style.display = '';
      }
      updateHourlyWage();
      displayStatistics();
      updateTurdTokenDisplay();
    }

    // ===== Wage & validation =====
    function updateHourlyWage(){
      if(wageToggle.checked){
        hourlyWage = parseFloat(hourlyWageField.value)||0;
      }else{
        const annual = parseFloat(annualSalaryInput.value)||0;
        const hours = parseFloat(weeklyHoursInput.value)||0;
        hourlyWage = hours>0 ? (annual/52)/hours : 0;
      }
      hourlyWageDisplay.textContent = `Your hourly wage: $${hourlyWage.toFixed(2)}`;
      saveUserData();
    }

    wageToggle.addEventListener('change', ()=>{
      hourlyInputs.style.display = wageToggle.checked ? '' : 'none';
      salaryInputs.style.display = wageToggle.checked ? 'none' : '';
      updateHourlyWage();
    });
    [annualSalaryInput, weeklyHoursInput, hourlyWageField].forEach(el=>el.addEventListener('input', updateHourlyWage));

    function validateInputs(){
      let ok = true;
      document.getElementById('salaryError').style.display = 'none';
      document.getElementById('hoursError').style.display = 'none';
      document.getElementById('hourlyWageError').style.display = 'none';

      if(wageToggle.checked){
        if(!hourlyWageField.value){
          document.getElementById('hourlyWageError').textContent = 'Please enter your hourly wage';
          document.getElementById('hourlyWageError').style.display = 'block'; ok=false;
        }
      }else{
        if(!annualSalaryInput.value){
          document.getElementById('salaryError').textContent = 'Please enter your annual salary';
          document.getElementById('salaryError').style.display = 'block'; ok=false;
        }
        if(!weeklyHoursInput.value){
          document.getElementById('hoursError').textContent = 'Please enter your weekly hours';
          document.getElementById('hoursError').style.display = 'block'; ok=false;
        }
      }
      return ok;
    }

    // ===== Timer & session =====
    function formatTime(s){const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`}

    function isFirstSessionOfDay(){
      const today = new Date().toDateString();
      const last = lastAwardDate ? new Date(lastAwardDate).toDateString() : null;
      if(today !== last){
        lastAwardDate = new Date().toISOString();
        turdTokens += 1;
        showTokenAwardNotification();
        saveUserData();
        return true;
      }
      return false;
    }

    function showTokenAwardNotification(){
      awardContainer.textContent = 'You earned 1 Turd Token for your first poop today';
      setTimeout(()=>{ awardContainer.textContent=''; }, 2500);
    }

    function updateTurdTokenDisplay(){
      const span = document.querySelector('.turd-token-balance span');
      if(span){ span.textContent = `TT: ${turdTokens}`; }
      walletBalance.textContent = turdTokens;
    }

    function startTimer(){
      if(!validateInputs()) return;
      if(!isTimerRunning){
        isTimerRunning = true;
        timerButton.textContent = 'Stop Pooping';
        poopEmoji.style.filter = 'brightness(1.2)';
        isFirstSessionOfDay();
        timerInterval = setInterval(()=>{
          seconds++;
          timerDisplay.textContent = formatTime(seconds);
          const earn = ((hourlyWage/3600)*seconds).toFixed(2);
          earningsDisplay.textContent = `Current earnings: $${earn}`;
        }, 1000);
      }else{
        stopAndRecord();
      }
    }

    function stopAndRecord(){
      isTimerRunning = false;
      clearInterval(timerInterval);
      const duration = seconds;
      const earnings = ((hourlyWage/3600)*duration).toFixed(2);
      seconds = 0;
      timerDisplay.textContent = '00:00:00';
      earningsDisplay.textContent = '';
      timerButton.textContent = 'Start Pooping';
      poopEmoji.style.filter = '';

      // Create log entry awaiting rating
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      const now = new Date();
      entry.innerHTML = `
        <p class="log-date">${now.toISOString()}</p>
        <p class="log-duration">${formatTime(duration)}</p>
        <p class="log-earnings">$${Number(earnings).toFixed(2)}</p>
        <p class="log-rating"><span class="rating-value"></span></p>
        <button class="delete-button" aria-label="Delete">√ó</button>
      `;
      wireDeleteButton(entry);
      poopLog.prepend(entry);
      poopLogPlaceholder.style.display = 'none';
      pendingLogEntryEl = entry;

      // Update stats immediately
      stats.totalSessions += 1;
      stats.totalPoopTime += duration;
      stats.totalEarnings += Number(earnings);
      const d = now.getTime();
      stats.firstSessionDate = stats.firstSessionDate ? Math.min(new Date(stats.firstSessionDate).getTime(), d) : d;
      stats.lastSessionDate = stats.lastSessionDate ? Math.max(new Date(stats.lastSessionDate).getTime(), d) : d;
      stats.firstSessionDate = new Date(stats.firstSessionDate);
      stats.lastSessionDate = new Date(stats.lastSessionDate);
      displayStatistics();
      saveUserData();

      openRatingModal();
    }

    function wireDeleteButton(entry){
      const btn = entry.querySelector('.delete-button');
      btn.onclick = ()=>{
        openConfirm(()=>{ // on confirm
          const durationText = entry.querySelector('.log-duration').textContent;
          const [h,m,s] = durationText.split(':').map(Number);
          const dur = h*3600 + m*60 + s;
          const earn = parseFloat(entry.querySelector('.log-earnings').textContent.replace(/[^0-9.-]+/g,''));
          // update stats
          stats.totalPoopTime -= dur;
          stats.totalEarnings -= earn;
          stats.totalSessions = Math.max(0, stats.totalSessions-1);
          entry.remove();
          if(!poopLog.children.length){ poopLogPlaceholder.style.display = ''; }
          updateDateRangeStats();
          displayStatistics();
          saveUserData();
        });
      };
    }

    // Confirm dialog
    function openConfirm(onYes){
      confirmDialog.style.display = 'block';
      const yes = ()=>{ confirmDialog.style.display='none'; confirmYes.removeEventListener('click',yes); confirmNo.removeEventListener('click',no); onYes(); };
      const no = ()=>{ confirmDialog.style.display='none'; confirmYes.removeEventListener('click',yes); confirmNo.removeEventListener('click',no); };
      confirmYes.addEventListener('click', yes);
      confirmNo.addEventListener('click', no);
    }

    // Rating modal
    function openRatingModal(){
      selectedRating = 0;
      ratingModal.style.display = 'block';
    }
    document.getElementById('emojiRow').addEventListener('click', e=>{
      const el = e.target.closest('.poopEmoji');
      if(!el) return;
      selectedRating = parseInt(el.dataset.rating||'0',10);
      Array.from(document.querySelectorAll('.poopEmoji')).forEach((n,i)=>{ n.style.opacity = (i < selectedRating) ? '1' : '0.4'; });
    });
    document.getElementById('submitRatingButton').addEventListener('click', ()=>{
      ratingModal.style.display = 'none';
      if(pendingLogEntryEl && selectedRating>0){
        pendingLogEntryEl.querySelector('.rating-value').textContent = 'üí©'.repeat(selectedRating);
        const earn = pendingLogEntryEl.querySelector('.log-earnings').textContent.replace('$','');
        openShareModal(earn, selectedRating);
        pendingLogEntryEl = null;
        saveUserData();
      }
    });

    // Share modal
    function openShareModal(earnings, rating){
      const msg = `I just had a ${'üí©'.repeat(rating)} poop and earned $${Number(earnings).toFixed(2)}. Find out your poop pay at www.poopprofit.com`;
      shareModal.style.display = 'block';
      document.getElementById('twitterShareButton').onclick = ()=> window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(msg)}`,'_blank');
      document.getElementById('facebookShareButton').onclick = ()=> window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://www.poopprofit.com')}&quote=${encodeURIComponent(msg)}`,'_blank');
      document.getElementById('smsShareButton').onclick = ()=> window.location.href = `sms:?&body=${encodeURIComponent(msg)}`;
    }

    // Stats
    function displayStatistics(){
      const t = stats.totalPoopTime;
      const hh = Math.floor(t/3600), mm = Math.floor((t%3600)/60), ss = t%60;
      const avg = stats.totalSessions>0 ? Math.floor(t / stats.totalSessions) : 0;
      const ah = Math.floor(avg/3600), am = Math.floor((avg%3600)/60), as = avg%60;

      let totalDays = 1;
      if(stats.firstSessionDate && stats.lastSessionDate){
        const first = new Date(stats.firstSessionDate);
        const last = new Date(stats.lastSessionDate);
        const diff = Math.max(0, last-first);
        totalDays = Math.max(1, Math.ceil(diff/(1000*60*60*24)));
      }

      document.getElementById('totalSessions').textContent = stats.totalSessions;
      document.getElementById('totalTime').textContent = `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
      document.getElementById('totalEarnings').textContent = stats.totalEarnings.toFixed(2);
      document.getElementById('avgPoopTime').textContent = `${String(ah).padStart(2,'0')}:${String(am).padStart(2,'0')}:${String(as).padStart(2,'0')}`;
      document.getElementById('avgEarnings').textContent = (stats.totalSessions>0 ? (stats.totalEarnings/stats.totalSessions) : 0).toFixed(2);
      document.getElementById('avgPoopsPerDay').textContent = (stats.totalSessions/totalDays).toFixed(2);

      updateStatsChart();
    }

    function updateStatsChart(){
      const ctx = document.getElementById('statsChart').getContext('2d');
      if(window._chart){ window._chart.destroy(); }
      const totalHours = Math.floor(stats.totalPoopTime/3600);
      const avgMinutesPerPoop = stats.totalSessions>0 ? Math.floor((stats.totalPoopTime/stats.totalSessions)/60) : 0;
      let totalDays = 1;
      if(stats.firstSessionDate && stats.lastSessionDate){
        const first = new Date(stats.firstSessionDate), last = new Date(stats.lastSessionDate);
        const diff = Math.max(0, last-first);
        totalDays = Math.max(1, Math.ceil(diff/(1000*60*60*24)));
      }
      const avgPerDay = Number((stats.totalSessions/totalDays).toFixed(2));
      window._chart = new Chart(ctx,{
        type:'bar',
        data:{
          labels:['Total Sessions','Avg Poops/Day','Total Hours','Avg Minutes/Poop','Total Earnings ($)'],
          datasets:[{label:'Statistics',data:[stats.totalSessions,avgPerDay,totalHours,avgMinutesPerPoop,Number(stats.totalEarnings.toFixed(2))]}]
        },
        options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
      });
    }

    function updateDateRangeStats(){
      if(stats.totalSessions===0){
        stats.firstSessionDate = null; stats.lastSessionDate = null; return;
      }
      const entries = Array.from(poopLog.children);
      if(entries.length){
        const dates = entries.map(e=> new Date(e.querySelector('.log-date').textContent).getTime());
        stats.firstSessionDate = new Date(Math.min(...dates));
        stats.lastSessionDate = new Date(Math.max(...dates));
      }
    }

    // Date filter
    function filterStatsByDateRange(start, end){
      const s = new Date(start); const e = new Date(end);
      const norm = d => new Date(d).toISOString().slice(0,10);
      const ns = norm(s), ne = norm(e);
      const filtered = { totalSessions:0,totalPoopTime:0,totalEarnings:0,firstSessionDate:null,lastSessionDate:null };

      const entries = Array.from(poopLog.children);
      entries.forEach(entry=>{
        const entryDate = norm(entry.querySelector('.log-date').textContent);
        if(entryDate>=ns && entryDate<=ne){
          const [h,m,sec] = entry.querySelector('.log-duration').textContent.split(':').map(Number);
          const dur = h*3600 + m*60 + sec;
          const earn = parseFloat(entry.querySelector('.log-earnings').textContent.replace(/[^0-9.-]+/g,''));
          filtered.totalSessions++;
          filtered.totalPoopTime += dur;
          filtered.totalEarnings += earn;
          const d = new Date(entry.querySelector('.log-date').textContent);
          filtered.firstSessionDate = filtered.firstSessionDate ? new Date(Math.min(filtered.firstSessionDate, d)) : d;
          filtered.lastSessionDate  = filtered.lastSessionDate  ? new Date(Math.max(filtered.lastSessionDate,  d)) : d;
        }
      });

      // Render filtered quick view without mutating base stats
      const t = filtered.totalPoopTime;
      const hh = Math.floor(t/3600), mm = Math.floor((t%3600)/60), ss = t%60;
      const avg = filtered.totalSessions>0 ? Math.floor(t/filtered.totalSessions) : 0;
      const ah = Math.floor(avg/3600), am = Math.floor((avg%3600)/60), as = avg%60;
      let totalDays = 1;
      if(filtered.firstSessionDate && filtered.lastSessionDate){
        const diff = Math.max(0, new Date(filtered.lastSessionDate) - new Date(filtered.firstSessionDate));
        totalDays = Math.max(1, Math.ceil(diff/(1000*60*60*24)));
      }

      document.getElementById('totalSessions').textContent = filtered.totalSessions;
      document.getElementById('totalTime').textContent = `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
      document.getElementById('totalEarnings').textContent = filtered.totalEarnings.toFixed(2);
      document.getElementById('avgPoopTime').textContent = `${String(ah).padStart(2,'0')}:${String(am).padStart(2,'0')}:${String(as).padStart(2,'0')}`;
      document.getElementById('avgEarnings').textContent = (filtered.totalSessions>0 ? (filtered.totalEarnings/filtered.totalSessions) : 0).toFixed(2);
      document.getElementById('avgPoopsPerDay').textContent = (filtered.totalSessions/totalDays).toFixed(2);

      // Mini chart for filtered
      const ctx = document.getElementById('statsChart').getContext('2d');
      if(window._chart){ window._chart.destroy(); }
      const totalHours = Math.floor(filtered.totalPoopTime/3600);
      const avgMinutesPerPoop = filtered.totalSessions>0 ? Math.floor((filtered.totalPoopTime/filtered.totalSessions)/60) : 0;
      const avgPerDay = filtered.totalSessions>0 ? Number((filtered.totalSessions/totalDays).toFixed(2)) : 0;
      window._chart = new Chart(ctx,{
        type:'bar',
        data:{ labels:['Total Sessions','Avg Poops/Day','Total Hours','Avg Minutes/Poop','Total Earnings ($)'],
          datasets:[{label:'Statistics',data:[filtered.totalSessions,avgPerDay,totalHours,avgMinutesPerPoop,Number(filtered.totalEarnings.toFixed(2))]}]},
        options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
      });
    }

    document.getElementById('filterStats').addEventListener('click', ()=>{
      const s = document.getElementById('startDate').value;
      const e = document.getElementById('endDate').value;
      if(s && e){ filterStatsByDateRange(s,e); }
    });
    document.getElementById('resetStats').addEventListener('click', displayStatistics);

    // Share statistics quick actions
    function statsShareMessage(){
      return `My poop stats: ${stats.totalSessions} sessions, ${formatTime(stats.totalPoopTime)}, earned $${stats.totalEarnings.toFixed(2)}. Check yours at www.poopprofit.com`;
    }
    shareStatsX.onclick = ()=> window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(statsShareMessage())}`,'_blank');
    shareStatsFB.onclick = ()=> window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://www.poopprofit.com')}&quote=${encodeURIComponent(statsShareMessage())}`,'_blank');
    shareStatsSMS.onclick = ()=> window.location.href = `sms:?&body=${encodeURIComponent(statsShareMessage())}`;

    // Buttons
    timerButton.addEventListener('click', startTimer);
    tokenWalletBtn.addEventListener('click', ()=> tokenWallet.style.display='block');
    tokenWallet.addEventListener('click', e=>{ if(e.target===tokenWallet) tokenWallet.style.display='none'; });
    ratingModal.addEventListener('click', e=>{ if(e.target===ratingModal) ratingModal.style.display='none'; });
    shareModal.addEventListener('click', e=>{ if(e.target===shareModal) shareModal.style.display='none'; });

    document.getElementById('logoutBtn').addEventListener('click', ()=>{
      localStorage.removeItem('currentUser');
      window.location.href = 'index.html';
    });

    // Init
    requireLogin();              // gate
    loadUserData();              // load saved state
    updateHourlyWage();          // compute wage line
    displayStatistics();         // paint stats
  </script>
</body>
</html>
<!-- JSON-LD Structured Data for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "PoopProfit",
  "operatingSystem": "All",
  "applicationCategory": "WebApplication",
  "url": "https://www.poopprofit.com",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "featureList": [
    "Poop Earnings Calculator",
    "View and Share Statistics",
    "Turd Token Rewards",
    "Degenerate Bathroom Games"
  ],
  "description": "PoopProfit is a unique web app where you can calculate your earnings from bathroom breaks at work, see your statistics, share your results, earn rewards, and play games.",
  "softwareVersion": "1.0.0"
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "PoopProfit.com",
  "url": "https://www.poopprofit.com",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.poopprofit.com/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Poop Profit - Calculate Your Earnings on Poop Breaks at Work.",
  "description": "Calculate how much you make to poop at work, view and share statistics, earn rewards, and play degenerate fun games at PoopProfit.com.",
  "url": "https://www.poopprofit.com",
  "inLanguage": "en",
  "isPartOf": {
    "@type": "WebSite",
    "url": "https://www.poopprofit.com"
  }
}
</script>
<!-- End of JSON-LD Structured Data -->

<base href="https://poopprofit.com/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Poop Profit: Your Ultimate Bathroom Companion</title>
<style>
    :root {
        --primary-color: #1a1a2e;
        --secondary-color: #16213e;
        --accent-color: #0f3460;
        --text-color: #00CED1;
        --light-text: #f1f1f1;
        --neon-blue: #3498db;
        --light-grey: #e0e0e0;
    }

    body {
        background-image: url('https://www.poopprofit.com/MAINDESKTOPBG.jpeg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        color: var(--light-text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Roboto', sans-serif;
    }

    .app-container {
        background-color: rgba(26, 26, 46, 0.8);
        border-radius: 10px;
        padding: 20px;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 60px;
    }

    header {
        position: relative;
        width: 100%;
        padding: 0;
        margin-bottom: 0.5rem;
        overflow: hidden;
        border-radius: 10px;
    }

    .header-image {
        width: 100%;
        height: auto;
        display: block;
    }

    .turd-token-balance {
        position: fixed;
        top: 20px;
        right: 10px;
        transform: none;
        z-index: 1000;
        font-size: 1.2em;
        padding: 10px;
        background-color: rgba(22, 33, 62, 0.9);
        border-radius: 10px;
        display: flex;
        align-items: center;
        cursor: pointer;
    }

    .turd-token-icon {
        width: 30px;
        height: 30px;
        margin-right: 5px;
    }

    main {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .interface-container {
        display: flex;
        flex-direction: column;
    }

    .tabs {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        width: 100%;
        background-color: rgba(22, 33, 62, 0.9);
        padding: 20px 0;
        border-radius: 10px 10px 0 0;
        position: relative;
    }

    .tab {
        padding: 15px;
        background-color: transparent;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 4px solid transparent;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .tab.active {
        background-color: var(--primary-color);
        border-bottom: 4px solid var(--neon-blue);
    }

    .tab:hover {
        background-color: var(--accent-color);
    }

    .tab-icon {
        width: 60px;
        height: 60px;
        transition: transform 0.3s ease;
    }

    @media (min-width: 768px) {
        .tab-icon {
            width: 80px;  
            height: 80px;
        }

        .tab {
            padding: 20px;
        }
    }

    .tab:hover .tab-icon {
        transform: scale(1.1);
    }

    .tab-content-container {
        flex: 1;
        background-color: rgba(26, 26, 46, 0.9);
        border-radius: 0 10px 10px 0;
        padding: 20px;
    }

    .tab-content {
        display: none;
        background-color: var(--primary-color);
        border: none;
        border-radius: 0;
        padding: 0;
        transition: opacity 0.3s ease-in-out;
        opacity: 1;
    }

    .tab-content.active {
        display: block;
    }

    .tab-content.fade-out {
        opacity: 0;
    }

    .calculator-container {
        background-color: transparent;
        box-shadow: none;
        padding: 0;
    }

    .calculator-title {
        font-size: 2.5rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 1rem;
        color: var(--neon-blue);
        text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 30px var(--neon-blue);
    }

    .calculator-description {
        font-size: 1.2rem;
        text-align: center;
        color: var(--light-grey);
        margin-bottom: 2rem;
    }

    .input-section {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
    }

    .wage-input-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .toggle-container {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
        margin-right: 15px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--accent-color);
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: var(--neon-blue);
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    #toggleLabel {
        font-size: 1rem;
        color: var(--light-text);
    }

    .input-group {
        margin-bottom: 15px;
    }

    .input-label {
        display: block;
        margin-bottom: 5px;
        color: var(--light-grey);
        font-size: 0.9rem;
    }

    .input-field {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--accent-color);
        border-radius: 5px;
        background-color: var(--secondary-color);
        color: var(--light-text);
        font-size: 1rem;
        transition: border-color 0.3s ease;
    }

    .input-field:focus {
        outline: none;
        border-color: var(--neon-blue);
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
    }

    .error-message {
        color: #ff4d4d;
        font-size: 0.8rem;
        margin-top: 5px;
        display: none;
    }

    @media (min-width: 768px) {
        #salaryHoursInputs, #hourlyWageInput {
            display: flex;
            gap: 20px;
        }

        .input-group {
            flex: 1;
        }
    }

    .hourly-wage {
        text-align: center;
        font-size: 1.2rem;
        margin-top: 1rem;
        color: var(--text-color);
    }

    .timer-section {
        text-align: center;
        margin-bottom: 2rem;
    }

    .poop-emoji {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .poop-emoji.wiggle {
        animation: wiggle 0.5s infinite;
    }

    .timer-display {
        font-size: 3rem;
        font-weight: bold;
        color: var(--text-color);
        margin-bottom: 1rem;
    }

    .timer-button {
        padding: 15px 30px;
        font-size: 1.2rem;
        border: none;
        border-radius: 50px;
        background-color: var(--neon-blue);
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .timer-button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 15px var(--neon-blue);
    }

    .earnings-display {
        font-size: 1.2rem;
        color: var(--text-color);
        margin-top: 1rem;
        font-weight: bold;
    }

    .poop-log-section {
        text-align: center;
        max-height: 300px;
        overflow-y: auto;
    }

    .poop-log-title {
        font-size: 1.5rem;
        color: var(--light-grey);
        margin-bottom: 1rem;
    }

    .poop-log-placeholder {
        color: var(--light-grey);
        font-style: italic;
    }

    .log-entry {
        background-color: var(--secondary-color);
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
    }

    .log-entry p {
        margin: 5px 0;
    }

    .log-entry .log-date {
        font-weight: bold;
        color: var(--neon-blue);
    }

    .log-entry .log-duration,
    .log-entry .log-earnings,
    .log-entry .log-rating {
        color: var(--light-grey);
    }

    .delete-button {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: #ff4d4d;
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .delete-button:hover {
        background-color: #ff1a1a;
    }

    .card {
        background-color: rgba(22, 33, 62, 0.8);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    @keyframes wiggle {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(-5deg); }
        75% { transform: rotate(5deg); }
        100% { transform: rotate(0deg); }
    }

    @media (max-width: 767px) {
        .tabs {
            flex-wrap: wrap;
        }

        .tab {
            flex: 1 0 25%;
            max-width: 25%;
        }

        .turd-token-balance {
            position: fixed;
            top: 10px;
            right: 10px;
            width: auto;
        }
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: var(--secondary-color);
        margin: 15% auto;
        padding: 20px;
        border: 1px solid var(--accent-color);
        width: 300px;
        border-radius: 10px;
        text-align: center;
    }

    .emoji-rating {
        font-size: 2rem;
        margin: 20px 0;
    }

    .poopEmoji {
        cursor: pointer;
        opacity: 0.5;
        transition: opacity 0.3s ease;
    }

    .poopEmoji:hover {
        opacity: 1;
    }

    #submitRatingButton {
        padding: 10px 20px;
        background-color: var(--neon-blue);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #submitRatingButton:hover {
        background-color: #2980b9;
    }

    .congrats-message {
        color: #4CAF50;
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 1.1em;
    }

    #shareModal .modal-content {
        width: 400px;
    }

    #shareModal button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        background-color: var(--neon-blue);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #shareModal button:hover {
        background-color: #2980b9;
    }

    #twitterShareButton {
        background-color: #1DA1F2;
    }

    #facebookShareButton {
        background-color: #4267B2;
    }

    #smsShareButton {
        background-color: #25D366;
    }

    #statisticsSection {
        margin-bottom: 20px;
    }

    .statistics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
        background: rgba(26, 26, 46, 0.4);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(52, 152, 219, 0.2);
    }

    .stat-card {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-card:before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            45deg,
            transparent,
            rgba(52, 152, 219, 0.1),
            transparent
        );
        transform: rotate(45deg);
        animation: shine 3s infinite;
    }

    .stat-card.featured {
        background: linear-gradient(145deg, rgba(52, 152, 219, 0.2), rgba(41, 128, 185, 0.2));
        border: 2px solid rgba(52, 152, 219, 0.5);
        padding: 30px;
    }

    .stat-card.featured p {
        font-size: 3.5rem;
        background: linear-gradient(45deg, #3498db, #2ecc71);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 10px;
    }

    .stat-card:not(.featured) p {
        font-size: 1.8rem;
        color: var(--text-color);
        text-shadow: 0 0 10px rgba(0, 206, 209, 0.5);
        margin-bottom: 5px;
    }

    .stat-card span {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    @keyframes shine {
        0% {
            left: -100%;
        }
        20% {
            left: 100%;
        }
        100% {
            left: 100%;
        }
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3), 
                    0 0 15px rgba(52, 152, 219, 0.5);
    }

    #statsChart {
        background: rgba(26, 26, 46, 0.8);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(52, 152, 219, 0.2);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        backdrop-filter: blur(4px);
    }

    .date-range-controls {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(52, 152, 219, 0.2);
        backdrop-filter: blur(10px);
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    .quick-filter-btn {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        padding: 12px 24px;
        border-radius: 10px;
        color: var(--light-text);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .quick-filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        border-color: rgba(52, 152, 219, 0.6);
    }

    .quick-filter-btn.active {
        background: linear-gradient(145deg, var(--neon-blue), #2980b9);
        border-color: var(--neon-blue);
        box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
    }

    #startDate, #endDate {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        border-radius: 10px;
        padding: 12px;
        color: var(--light-text);
        transition: all 0.3s ease;
    }

    #startDate:focus, #endDate:focus {
        outline: none;
        border-color: var(--neon-blue);
        box-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
    }

    #filterStats, #resetStats {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        border-radius: 10px;
        padding: 12px 24px;
        color: var(--light-text);
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    #filterStats {
        background: linear-gradient(145deg, var(--neon-blue), #2980b9);
    }

    #filterStats:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
    }

    #resetStats {
        background: linear-gradient(145deg, #e74c3c, #c0392b);
        border-color: #e74c3c;
    }

    #resetStats:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
    }

    .date-range-divider {
        color: var(--light-text);
        opacity: 0.7;
        font-size: 0.9em;
    }

    .date-range-header {
        color: var(--light-text);
        font-size: 1.2em;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
    }

    .game-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        padding: 20px;
    }

    .game-link {
        display: block;
        text-align: center;
    }

    .game-image {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
        transition: transform 0.3s ease;
    }

    .game-image:hover {
        transform: scale(1.05);
    }

    .confirm-dialog {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
    }

    .confirm-dialog-content {
        background-color: var(--secondary-color);
        border-radius: 10px;
        padding: 20px;
        width: 300px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .confirm-dialog-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }

    .confirm-dialog button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .confirm-dialog .confirm {
        background-color: #ff4d4d;
        color: white;
    }

    .confirm-dialog .cancel {
        background-color: var(--neon-blue);
        color: white;
    }

    .confirm-dialog button:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
 .popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.popup-content {
    background-color: #000;
    border: 1px solid #00ffff;
    padding: 20px;
    border-radius: 8px;
    width: 80%;
    max-width: 400px;
    text-align: center;
    color: #00ffff;
}

.close-btn {
    color: #00ffff;
    float: right;
    font-size: 1.5em;
    cursor: pointer;
    margin-top: -10px;
}

    .logout-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 20px;
    background: linear-gradient(145deg, var(--secondary-color), var(--accent-color));
    color: var(--light-text);
    border: 1px solid rgba(52, 152, 219, 0.3);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    z-index: 1000;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    background: linear-gradient(145deg, var(--accent-color), var(--neon-blue));
}

    /* Container for share buttons */
.share-statistics {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 20px;
}

/* Base style for each share button */
.share-button {
    background-color: var(--secondary-color); /* Customizable background color */
    border: none;
    border-radius: 75%; /* Circular button style */
    width: 75px
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let annualSalaryInput, weeklyHoursInput, wageToggle, hourlyWageField, hourlyWageDisplay;
let salaryHoursInputs, hourlyWageInput, toggleLabel;
let timerInterval, isTimerRunning = false, seconds = 0;
let hourlyWage = 0;
let poopLogs = [];
let turdTokens = 0;
let lastAwardDate = null;
let chart;
const poopLog = document.getElementById('poopLog');
const poopLogPlaceholder = document.getElementById('poopLogPlaceholder');
const timerDisplay = document.getElementById('timerDisplay');
const earningsDisplay = document.getElementById('earningsDisplay');
const timerButton = document.getElementById('timerButton');
const poopEmoji = document.querySelector('.poop-emoji');

function formatTime(seconds) {
    const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
    const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
    const s = (seconds % 60).toString().padStart(2, '0');
    return `${h}:${m}:${s}`;
}

function updateHourlyWage() {
    if (wageToggle.checked) {
        hourlyWage = parseFloat(hourlyWageField.value) || 0;
    } else {
        const annualSalary = parseFloat(annualSalaryInput.value) || 0;
        const weeklyHours = parseFloat(weeklyHoursInput.value) || 0;
        hourlyWage = (annualSalary / 52 / weeklyHours) || 0;
    }
    hourlyWageDisplay.textContent = `Your hourly wage: $${hourlyWage.toFixed(2)}`;
    saveUserData();
}

function startTimer() {
    if (!isTimerRunning) {
        isTimerRunning = true;
        timerButton.textContent = 'Stop Pooping';
        poopEmoji.classList.add('wiggle');
        timerInterval = setInterval(() => {
            seconds++;
            timerDisplay.textContent = formatTime(seconds);
            const earnings = ((hourlyWage / 3600) * seconds).toFixed(2);
            earningsDisplay.textContent = `Current earnings: $${earnings}`;
        }, 1000);
    } else {
        isTimerRunning = false;
        clearInterval(timerInterval);
        timerButton.textContent = 'Start Pooping';
        poopEmoji.classList.remove('wiggle');
        openRatingModal(); // Assume this handles ending the session and rating
        seconds = 0;
        timerDisplay.textContent = '00:00:00';
        earningsDisplay.textContent = '';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    annualSalaryInput = document.getElementById('annualSalary');
    weeklyHoursInput = document.getElementById('weeklyHours');
    wageToggle = document.getElementById('wageToggle');
    hourlyWageField = document.getElementById('hourlyWageField');
    hourlyWageDisplay = document.getElementById('hourlyWage');
    salaryHoursInputs = document.getElementById('salaryHoursInputs');
    hourlyWageInput = document.getElementById('hourlyWageInput');
    toggleLabel = document.getElementById('toggleLabel');

    checkLoginStatus();
    loadUserData();
    updateHourlyWage();
    displayStatistics();

    annualSalaryInput.addEventListener('input', updateHourlyWage);
    weeklyHoursInput.addEventListener('input', updateHourlyWage);
    hourlyWageField.addEventListener('input', updateHourlyWage);
    
    const allTimeStatsBtn = document.getElementById('allTimeStats');
    const todayStatsBtn = document.getElementById('todayStats');
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    const filterButton = document.getElementById('filterStats');
    const resetButton = document.getElementById('resetStats');

    const ratingModal = document.getElementById('ratingModal');
    const congratsMessage = document.getElementById('congratsMessage');
    const poopEmojis = document.querySelectorAll('.poopEmoji');
    const submitRatingButton = document.getElementById('submitRatingButton');
    let selectedRating = 0;

    poopEmojis.forEach(emoji => {
        emoji.addEventListener('click', () => {
            selectedRating = parseInt(emoji.dataset.rating);
            poopEmojis.forEach((e, index) => {
                e.style.opacity = index < selectedRating ? '1' : '0.5';
            });
        });
    });

    submitRatingButton.addEventListener('click', () => {
    if (selectedRating > 0) {
        poopLogs[poopLogs.length - 1].rating = 'üí©'.repeat(selectedRating);
        ratingModal.style.display = 'none';
        
        // Get the earnings from the latest poop log
        const earnings = poopLogs[poopLogs.length - 1].earnings.toFixed(2);

        renderPoopLogs();
        saveUserData();
        // Show the share modal with accurate earnings
        openShareModal(earnings, selectedRating);
    }
});


function openShareModal(earnings, rating) {
    const ratingText = rating > 0 ? 'üí©'.repeat(rating) : '';
    const message = `I just had a ${ratingText}-poop and earned $${earnings}! Find out how much you make to poop at www.poopprofit.com!`;

    const shareModal = document.getElementById('shareModal');
    shareModal.style.display = 'block';

    // Set up event listeners for the sharing buttons
    document.getElementById('twitterShareButton').onclick = () => shareOnTwitter(message);
    document.getElementById('facebookShareButton').onclick = () => shareOnFacebook(message);
    document.getElementById('smsShareButton').onclick = () => shareViaSMS(message);
}

function shareOnTwitter(message) {
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`;
    window.open(twitterUrl, '_blank');
}

function shareOnFacebook(message) {
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://www.poopprofit.com')}&quote=${encodeURIComponent(message)}`;
    window.open(facebookUrl, '_blank');
}

function shareViaSMS(message) {
    window.open(`sms:?&body=${encodeURIComponent(message)}`);
}

    timerButton.addEventListener('click', startTimer);

    todayStatsBtn.addEventListener('click', () => {
        clearActiveFilters();
        todayStatsBtn.classList.add('active');
        filterStatsByDay(new Date());
    });

    allTimeStatsBtn.addEventListener('click', () => {
        clearActiveFilters();
        allTimeStatsBtn.classList.add('active');
        displayStatistics();
    });

    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const tabId = tab.getAttribute('data-tab');
            const activeContent = document.querySelector('.tab-content.active');
            const newContent = document.getElementById(`${tabId}Tab`);

            activeContent.classList.add('fade-out');

            setTimeout(() => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active', 'fade-out'));
                
                tab.classList.add('active');
                newContent.classList.add('active', 'fade-out');

                void newContent.offsetWidth;

                newContent.classList.remove('fade-out');
            }, 300); 
        });
    });

    function filterStatsByDay(date) {
    // Set the start and end of the day for the given date
    const startOfDay = new Date(date);
    startOfDay.setHours(0, 0, 0, 0); // Start of the day (00:00:00.000)

    const endOfDay = new Date(date);
    endOfDay.setHours(23, 59, 59, 999); // End of the day (23:59:59.999)

    // Log start and end times for debugging
    console.log("Filtering stats for the day:", date);
    console.log("Start of Day:", startOfDay);
    console.log("End of Day:", endOfDay);

    // Call filterStatsByDateRange to filter logs for the specific day
    filterStatsByDateRange(startOfDay, endOfDay);
}


    filterButton.addEventListener('click', () => {
        const startDate = startDateInput.value;
        const endDate = endDateInput.value;
        if (startDate && endDate) {
            filterStatsByDateRange(startDate, endDate);
        } else {
            alert('Please select both start and end dates.');
        }
    });

    resetButton.addEventListener('click', () => {
        clearActiveFilters();
        displayStatistics();
    });

    const turdTokenBalance = document.getElementById('turdTokenBalance');
    const turdTokenWallet = document.getElementById('turdTokenWallet');
    const walletBalance = document.getElementById('walletBalance');

    turdTokenBalance.addEventListener('click', () => {
        turdTokenWallet.style.display = 'block';
        walletBalance.textContent = turdTokens;
    });

    turdTokenWallet.querySelector('.close').addEventListener('click', () => {
        turdTokenWallet.style.display = 'none';
    });

    wageToggle.addEventListener('change', function() {
        if (this.checked) {
            salaryHoursInputs.style.display = 'none';
            hourlyWageInput.style.display = 'block';
            toggleLabel.textContent = 'Hourly Wage';
        } else {
            salaryHoursInputs.style.display = 'block';
            hourlyWageInput.style.display = 'none';
            toggleLabel.textContent = 'Salary & Hours';
        }
        updateHourlyWage();
    });

    window.onclick = function(event) {
        if (event.target == ratingModal) {
            ratingModal.style.display = "none";
        }
        if (event.target == document.getElementById('shareModal')) {
            document.getElementById('shareModal').style.display = 'none';
        }
        if (event.target == document.getElementById('turdTokenWallet')) {
            document.getElementById('turdTokenWallet').style.display = 'none';
        }
        if (event.target == document.querySelector('.confirm-dialog')) {
            document.querySelector('.confirm-dialog').style.display = 'none';
        }
    }
});

function checkLoginStatus() {
    if (!localStorage.getItem('currentUser')) {
        window.location.href = '/index.html';
    }
}

function loadUserData() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (currentUser && currentUser.data) {
        poopLogs = currentUser.data.poopLogs || [];
        turdTokens = currentUser.data.turdTokens || 0;
        lastAwardDate = currentUser.data.lastAwardDate || null;
        annualSalaryInput.value = currentUser.data.annualSalary || '';
        weeklyHoursInput.value = currentUser.data.weeklyHours || '';
        hourlyWageField.value = currentUser.data.hourlyWageInput || '';
        wageToggle.checked = currentUser.data.wageToggle || false;
        if (wageToggle.checked) {
            salaryHoursInputs.style.display = 'none';
            hourlyWageInput.style.display = 'block';
            toggleLabel.textContent = 'Hourly Wage';
        } else {
            salaryHoursInputs.style.display = 'block';
            hourlyWageInput.style.display = 'none';
            toggleLabel.textContent = 'Salary & Hours';
        }
        renderPoopLogs();
        updateTurdTokenDisplay();
    }
}

function saveUserData() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if (currentUser) {
        currentUser.data.poopLogs = poopLogs;
        currentUser.data.turdTokens = turdTokens;
        currentUser.data.lastAwardDate = lastAwardDate;
        currentUser.data.annualSalary = annualSalaryInput.value;
        currentUser.data.weeklyHours = weeklyHoursInput.value;
        currentUser.data.hourlyWageInput = hourlyWageField.value;
        currentUser.data.wageToggle = wageToggle.checked;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        const users = JSON.parse(localStorage.getItem('users'));
        if (users && users[currentUser.email]) {
            users[currentUser.email].data = currentUser.data;
            localStorage.setItem('users', JSON.stringify(users));
        }
    }
}

function isFirstSessionOfDay() {
    const today = new Date().toDateString();
    return !lastAwardDate || new Date(lastAwardDate).toDateString() !== today;
}

function showTokenAwardNotification() {
    alert('You earned a Turd Token for your first poop today!');
}

function renderPoopLogs() {
    poopLog.innerHTML = '';
    poopLogs.forEach((log, index) => {
        const logEntry = document.createElement('div');
        logEntry.className = 'log-entry';
        logEntry.innerHTML = `
            <button class="delete-button">√ó</button>
            <p class="log-date">${new Date(log.date).toLocaleString()}</p>
            <p class="log-duration">Duration: ${formatTime(log.duration)}</p>
            <p class="log-earnings">Earnings: $${log.earnings.toFixed(2)}</p>
            <p class="log-rating">Rating: <span class="rating-value">${log.rating || 'Not rated'}</span></p>
        `;
        const deleteButton = logEntry.querySelector('.delete-button');
        deleteButton.onclick = () => confirmDelete(logEntry);
        logEntry.dataset.index = index;
        poopLog.appendChild(logEntry);
    });
    poopLogPlaceholder.style.display = poopLogs.length === 0 ? 'block' : 'none';
}

function confirmDelete(logEntry) {
    const dialog = document.querySelector('.confirm-dialog');
    dialog.style.display = 'block';
    const confirmBtn = dialog.querySelector('.confirm');
    const cancelBtn = dialog.querySelector('.cancel');

    const confirmListener = () => {
        const index = parseInt(logEntry.dataset.index);
        poopLogs.splice(index, 1);
        renderPoopLogs();
        displayStatistics();
        saveUserData();
        dialog.style.display = 'none';
        confirmBtn.removeEventListener('click', confirmListener);
        cancelBtn.removeEventListener('click', cancelListener);
    };

    const cancelListener = () => {
        dialog.style.display = 'none';
        confirmBtn.removeEventListener('click', confirmListener);
        cancelBtn.removeEventListener('click', cancelListener);
    };

    confirmBtn.addEventListener('click', confirmListener);
    cancelBtn.addEventListener('click', cancelListener);
}

function updateTurdTokenDisplay() {
    document.querySelector('#turdTokenBalance span').textContent = `TT: ${turdTokens}`;
}

function openRatingModal() {
    const ratingModal = document.getElementById('ratingModal');
    const congratsMessage = document.getElementById('congratsMessage');
    const poopEmojis = document.querySelectorAll('.poopEmoji');
    
    const earnings = ((hourlyWage / 3600) * seconds).toFixed(2);
    congratsMessage.textContent = `Congratulations! You just earned $${earnings}!`;
    
    ratingModal.style.display = 'block';
    selectedRating = 0;
    
    poopEmojis.forEach(emoji => {
        emoji.style.opacity = '0.5';
    });

    if (isFirstSessionOfDay()) {
        turdTokens++;
        lastAwardDate = new Date().toISOString();
        updateTurdTokenDisplay();
        showTokenAwardNotification();
    }

    const currentDate = new Date().toISOString();
    poopLogs.unshift({
        date: currentDate,
        duration: seconds,
        earnings: parseFloat(earnings),
        rating: null
    });

    renderPoopLogs();
    saveUserData();
}

function shareStatisticsOnTwitter() {
    const statsText = getShareableStats();
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(statsText)}`;
    window.open(twitterUrl, '_blank');
}

function shareStatisticsOnFacebook() {
    const statsText = getShareableStats();
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://www.poopprofit.com')}&quote=${encodeURIComponent(statsText)}`;
    window.open(facebookUrl, '_blank');
}

function shareStatisticsViaSMS() {
    const statsText = getShareableStats();
    window.open(`sms:?&body=${encodeURIComponent(statsText)}`);
}

function getShareableStats() {
    const totalSessions = poopLogs.length;
    const totalEarnings = poopLogs.reduce((sum, log) => sum + log.earnings, 0);
    const avgEarnings = totalSessions > 0 ? (totalEarnings / totalSessions).toFixed(2) : 0;
    return `My Poop Profit Stats:
Total Poops at Work: ${totalSessions}
Total I've Got Paid to Poop: $${totalEarnings.toFixed(2)}
Average Earnings Per Poop: $${avgEarnings}
Find out how much YOU get paid to poop at www.poopprofit.com!`;
}

function clearActiveFilters() {
    document.getElementById('allTimeStats').classList.remove('active');
    document.getElementById('todayStats').classList.remove('active');
    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';
}

function filterStatsByDateRange(start, end) {
    const startDate = new Date(start);
    const endDate = new Date(end);
    endDate.setHours(23, 59, 59, 999);
    const filteredLogs = poopLogs.filter(log => {
        const logDate = new Date(log.date);
        return logDate >= startDate && logDate <= endDate;
    });
    displayStatistics(filteredLogs);
}

function displayStatistics(filteredLogs = null) {
    const logs = filteredLogs || poopLogs;
    const tempStats = {
        totalSessions: logs.length,
        totalPoopTime: logs.reduce((sum, l) => sum + l.duration, 0),
        totalEarnings: logs.reduce((sum, l) => sum + l.earnings, 0),
        avgPoopsPerDay: 0
    };

    if (logs.length > 0) {
        const sorted = [...logs].sort((a, b) => new Date(a.date) - new Date(b.date));
        const firstDate = new Date(sorted[0].date);
        const lastDate = new Date(sorted[sorted.length - 1].date);
        const days = Math.max(1, (lastDate - firstDate) / (1000 * 60 * 60 * 24) + 1);
        tempStats.avgPoopsPerDay = (tempStats.totalSessions / days).toFixed(2);
    }

    document.getElementById('totalEarnings').textContent = tempStats.totalEarnings.toFixed(2);
    document.getElementById('totalSessions').textContent = tempStats.totalSessions;
    document.getElementById('totalTime').textContent = formatTime(tempStats.totalPoopTime);
    document.getElementById('avgPoopTime').textContent = formatTime(tempStats.totalPoopTime / tempStats.totalSessions || 0);
    document.getElementById('avgEarnings').textContent = (tempStats.totalEarnings / tempStats.totalSessions || 0).toFixed(2);
    document.getElementById('avgPoopsPerDay').textContent = tempStats.avgPoopsPerDay;

    const chartData = getChartData(logs);
    const ctx = document.getElementById('statsChart').getContext('2d');
    if (chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartData.labels,
            datasets: [{
                label: 'Daily Earnings',
                data: chartData.data,
                borderColor: 'rgb(52, 152, 219)',
                backgroundColor: 'rgba(52, 152, 219, 0.2)',
                fill: true
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function getChartData(logs) {
    const grouped = {};
    logs.forEach(log => {
        const dateStr = new Date(log.date).toDateString();
        if (!grouped[dateStr]) grouped[dateStr] = 0;
        grouped[dateStr] += log.earnings;
    });
    const sortedDates = Object.keys(grouped).sort((a, b) => new Date(a) - new Date(b));
    return {
        labels: sortedDates,
        data: sortedDates.map(d => grouped[d])
    };
}

// Clear `currentUser` on logout
function logout() {
    localStorage.removeItem('currentUser');
    window.location.href = '/index.html'; // Redirect to login page
}
</script>
</head>
<body>
<div class="app-container">
    <header>
        <img src="https://www.poopprofit.com/BANNER.jpeg" alt="Poop Profit Header" class="header-image">
    </header>
    <main>
        <div class="interface-container">
            <div class="turd-token-balance" id="turdTokenBalance">
                <img src="https://www.poopprofit.com/Turdtoken.png" alt="Turd Token" class="turd-token-icon">
                <span>TT: 1</span>
            </div>
            <div class="tabs">
                <button class="tab active" data-tab="calculator">
                    <img src="https://www.poopprofit.com/calc.png" alt="Calculator" class="tab-icon">
                </button>
                <button class="tab" data-tab="statistics">
                    <img src="https://www.poopprofit.com/stats.png" alt="Bathroom Game 2" class="tab-icon">
                </button>
                <button class="tab" data-tab="games">
                    <img src="https://www.poopprofit.com/games.png" alt="Statistics" class="tab-icon">
                </button>
                <button class="tab" data-tab="shop">
                    <img src="https://www.poopprofit.com/shop.png" alt="Shop" class="tab-icon">
                </button>
            </div>

            <div class="tab-content-container">
                <div id="shopTab" class="tab-content">
                    <img src="https://www.poopprofit.com/Storecomingsoon.png" alt="Shop Items Coming Soon" class="shop-image" style="display: block; margin: 0 auto; max-width: 100%; height: auto;">
                </div><div id="gamesTab" class="tab-content">
                    <h2></h2>
                    <div class="game-grid">
                        <a href="/TurdToTheMoon.html" class="game-link" target="_blank">
                            <img src="https://www.poopprofit.com/Screenshot_20241017_202614.jpg" alt="Bathroom Game 1" class="game-image">
                        </a>
                        <a href="/TurdRaceGame.html" class="game-link" target="_blank">
                            <img src="https://www.poopprofit.com/Screenshot_20241017_202104.jpg" alt="Bathroom Game 3" class="game-image">
                        </a>
                        <a href="#game2" class="game-link" target="_blank">
                            <img src="https://www.poopprofit.com/Screenshot_20241017_202832.jpg" alt="Bathroom Game 2" class="game-image">
                        </a>
                    </div>
                </div><div id="calculatorTab" class="tab-content active">
                    <div class="calculator-container">
                        <h1 class="calculator-title">Poop Profit Calculator</h1>
                        <p class="calculator-description">Calculate how much money you make while pooping at work!</p>

                        <div class="input-section card">
                            <div class="wage-input-container">
                                <div class="toggle-container">
                                    <label class="switch">
                                        <input type="checkbox" id="wageToggle">
                                        <span class="slider round"></span>
                                    </label>
                                    <span id="toggleLabel">Salary &amp; Hours</span>
                                </div>
                                <div id="salaryHoursInputs">
                                    <div class="input-group">
                                        <label for="annualSalary" class="input-label">Annual Salary</label>
                                        <input type="number" id="annualSalary" class="input-field" placeholder="Enter your annual salary">
                                        <span id="salaryError" class="error-message"></span>
                                    </div>
                                    <div class="input-group">
                                        <label for="weeklyHours" class="input-label">Weekly Work Hours</label>
                                        <input type="number" id="weeklyHours" class="input-field" placeholder="Enter your weekly work hours">
                                        <span id="hoursError" class="error-message"></span>
                                    </div>
                                </div>
                                <div id="hourlyWageInput" style="display: none;">
                                    <div class="input-group">
                                        <label for="hourlyWageField" class="input-label">Hourly Wage</label>
                                        <input type="number" id="hourlyWageField" class="input-field" placeholder="Enter your hourly wage">
                                        <span id="hourlyWageError" class="error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hourly-wage" id="hourlyWage">Your hourly wage: $250.00</div>

                        <div class="timer-section card">
                            <div class="poop-emoji">üí©</div>
                            <div class="timer-display" id="timerDisplay">00:00:00</div>
                            <button class="timer-button" id="timerButton">Start Pooping</button>
                            <div class="earnings-display" id="earningsDisplay"></div>
                        </div>

                        <div class="poop-log-section card">
                            <h2 class="poop-log-title">Poop Log</h2>
                            <p class="poop-log-placeholder" id="poopLogPlaceholder" style="display: none;">No poop sessions logged yet!</p>
                            <div id="poopLog"><div class="log-entry">
        <button class="delete-button">√ó</button>
        <p class="log-date">11/5/2024, 4:30:27 AM</p>
        <p class="log-duration">Duration: 00:00:01</p>
        <p class="log-earnings">Earnings: $0.07</p>
        <p class="log-rating">Rating: <span class="rating-value">Not rated</span></p>
    </div><div class="log-entry">
        <button class="delete-button">√ó</button>
        <p class="log-date">11/5/2024, 4:30:22 AM</p>
        <p class="log-duration">Duration: 00:00:02</p>
        <p class="log-earnings">Earnings: $0.14</p>
        <p class="log-rating">Rating: <span class="rating-value">üí©üí©üí©üí©üí©</span></p>
    </div></div>
                        </div>
                    </div>
                </div>

                <div id="statisticsTab" class="tab-content">
                    <h2></h2>
                    <div class="date-range-header">View Statistics By</div>
                    <div class="date-range-controls">
                        <button id="allTimeStats" class="quick-filter-btn">All Time</button>
                        <button id="todayStats" class="quick-filter-btn">Today</button>
                        <div class="date-range-divider">or</div>
                        <input type="date" id="startDate" placeholder="Start Date">
                        <input type="date" id="endDate" placeholder="End Date">
                        <button id="filterStats">Filter Range</button>
                        <button id="resetStats">Reset</button>
                    </div>
                    <div id="statisticsSection" class="statistics-grid">
                        <div class="stat-card featured" style="grid-column: 1 / -1; margin-bottom: 20px;">
    <p id="totalEarnings">0.21</p>
    <span>Total Earnings</span>
</div>
                        <div class="stat-card">
                            <p id="totalSessions">2</p>
                            <span>Total Sessions</span>
                        </div>
                        <div class="stat-card">
                            <p id="totalTime">00:00:05</p>
                            <span>Total Time</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgPoopTime">00:00:02</p>
                            <span>Avg Poop Time</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgEarnings">0.11</p>
                            <span>Avg Earnings</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgPoopsPerDay">2.00</p>
                            <span>Avg Poops/Day</span>
                        </div>
                    </div>
                    <canvas id="statsChart" width="1063" height="797" style="margin-top: 20px; display: block; box-sizing: border-box; height: 797px; width: 1063px;"></canvas>
                    <div class="share-statistics">
    <button class="share-button twitter" onclick="shareStatisticsOnTwitter()">
        <img src="https://www.poopprofit.com/xicon.png" alt="Twitter Icon">
    </button>
    <button class="share-button facebook" onclick="shareStatisticsOnFacebook()">
        <img src="https://www.poopprofit.com/fbicon.png" alt="Facebook Icon">
    </button>
    <button class="share-button sms" onclick="shareStatisticsViaSMS()">
        <img src="https://www.poopprofit.com/txticon.png" alt="SMS Icon">
    </button>
</div>

                

                
            </div>
        </div>
    </div></main>
</div>

<div id="ratingModal" class="modal">
    <div class="modal-content">
        <p id="congratsMessage" class="congrats-message"></p>
        <h2>Rate Your Poop Session</h2>
        <div class="emoji-rating">
            <span class="poopEmoji" data-rating="1">üí©</span>
            <span class="poopEmoji" data-rating="2">üí©</span>
            <span class="poopEmoji" data-rating="3">üí©</span>
            <span class="poopEmoji" data-rating="4">üí©</span>
            <span class="poopEmoji" data-rating="5">üí©</span>
        </div>
        <button id="submitRatingButton">Submit Rating</button>
    </div>
</div>

<div id="shareModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="document.getElementById('shareModal').style.display='none'">√ó</span>
        <h2>Share Your Earnings!</h2>
        <button id="twitterShareButton">Share on Twitter</button>
        <button id="facebookShareButton">Share on Facebook</button>
        <button id="smsShareButton">Share via SMS</button>
    </div>
</div>

<div class="confirm-dialog">
    <div class="confirm-dialog-content">
        <p>Are you sure you want to delete this log entry?</p>
        <div class="confirm-dialog-buttons">
            <button class="confirm">Yes, delete</button>
            <button class="cancel">Cancel</button>
        </div>
    </div>
</div>

<div id="turdTokenWallet" class="modal">
    <div class="modal-content">
        <span class="close">√ó</span>
        <h2>Turd Token Wallet</h2>
        <div class="wallet-content">
            <img src="https://www.poopprofit.com/Turdtoken.png" alt="Turd Token" class="wallet-token-icon" style="width: 64px; height: 64px; margin: 10px auto; display: block;">
            <p>Balance: <span id="walletBalance">0</span> TT</p>
        </div>
        <p style="text-align: center; margin-top: 20px; font-style: italic;">COMING SOON</p>
    </div>
</div>
<!-- Popup HTML -->
<div id="gamesPopup" class="popup" style="display: none;">
    <div class="popup-content">
        <span class="close-btn" onclick="closePopup()">√ó</span>
        <p>Turd Token Wallet Coming Soon! For now, only demo tokens are available for all games.</p>
    </div>
</div>

<!-- JavaScript for Popup -->
<script>
    function showPopup() {
        document.getElementById("gamesPopup").style.display = "flex";
    }

    function closePopup() {
        document.getElementById("gamesPopup").style.display = "none";
    }

    // Trigger popup when "Games" tab is clicked
    document.querySelector('.tab[data-tab="games"]').addEventListener("click", function(event) {
        event.preventDefault(); // Prevents any default behavior
        showPopup();
    });
</script>

<button class="logout-btn" onclick="logout()">Logout</button>

</body></html><!-- JSON-LD Structured Data for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "PoopProfit",
  "operatingSystem": "All",
  "applicationCategory": "WebApplication",
  "url": "https://www.poopprofit.com",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "featureList": [
    "Poop Earnings Calculator",
    "View and Share Statistics",
    "Turd Token Rewards",
    "Degenerate Bathroom Games"
  ],
  "description": "PoopProfit is a unique web app where you can calculate your earnings from bathroom breaks at work, see your statistics, share your results, earn rewards, and play games.",
  "softwareVersion": "1.0.0"
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "PoopProfit.com",
  "url": "https://www.poopprofit.com",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.poopprofit.com/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "Poop Profit - Calculate Your Earnings on Poop Breaks at Work.",
  "description": "Calculate how much you make to poop at work, view and share statistics, earn rewards, and play degenerate fun games at PoopProfit.com.",
  "url": "https://www.poopprofit.com",
  "inLanguage": "en",
  "isPartOf": {
    "@type": "WebSite",
    "url": "https://www.poopprofit.com"
  }
}
</script>
<!-- End of JSON-LD Structured Data -->

<base href="https://poopprofit.com/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Poop Profit: Your Ultimate Bathroom Companion</title>
<style>
    :root {
        --primary-color: #1a1a2e;
        --secondary-color: #16213e;
        --accent-color: #0f3460;
        --text-color: #00CED1;
        --light-text: #f1f1f1;
        --neon-blue: #3498db;
        --light-grey: #e0e0e0;
    }

    body {
        background-image: url('https://www.poopprofit.com/MAINDESKTOPBG.jpeg');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        color: var(--light-text);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Roboto', sans-serif;
    }

    .app-container {
        background-color: rgba(26, 26, 46, 0.8);
        border-radius: 10px;
        padding: 20px;
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding-top: 60px;
    }

    header {
        position: relative;
        width: 100%;
        padding: 0;
        margin-bottom: 0.5rem;
        overflow: hidden;
        border-radius: 10px;
    }

    .header-image {
        width: 100%;
        height: auto;
        display: block;
    }

    .turd-token-balance {
        position: fixed;
        top: 20px;
        right: 10px;
        transform: none;
        z-index: 1000;
        font-size: 1.2em;
        padding: 10px;
        background-color: rgba(22, 33, 62, 0.9);
        border-radius: 10px;
        display: flex;
        align-items: center;
        cursor: pointer;
    }

    .turd-token-icon {
        width: 30px;
        height: 30px;
        margin-right: 5px;
    }

    main {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .interface-container {
        display: flex;
        flex-direction: column;
    }

    .tabs {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        width: 100%;
        background-color: rgba(22, 33, 62, 0.9);
        padding: 20px 0;
        border-radius: 10px 10px 0 0;
        position: relative;
    }

    .tab {
        padding: 15px;
        background-color: transparent;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        border-bottom: 4px solid transparent;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .tab.active {
        background-color: var(--primary-color);
        border-bottom: 4px solid var(--neon-blue);
    }

    .tab:hover {
        background-color: var(--accent-color);
    }

    .tab-icon {
        width: 60px;
        height: 60px;
        transition: transform 0.3s ease;
    }

    @media (min-width: 768px) {
        .tab-icon {
            width: 80px;  
            height: 80px;
        }

        .tab {
            padding: 20px;
        }
    }

    .tab:hover .tab-icon {
        transform: scale(1.1);
    }

    .tab-content-container {
        flex: 1;
        background-color: rgba(26, 26, 46, 0.9);
        border-radius: 0 10px 10px 0;
        padding: 20px;
    }

    .tab-content {
        display: none;
        background-color: var(--primary-color);
        border: none;
        border-radius: 0;
        padding: 0;
        transition: opacity 0.3s ease-in-out;
        opacity: 1;
    }

    .tab-content.active {
        display: block;
    }

    .tab-content.fade-out {
        opacity: 0;
    }

    .calculator-container {
        background-color: transparent;
        box-shadow: none;
        padding: 0;
    }

    .calculator-title {
        font-size: 2.5rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 1rem;
        color: var(--neon-blue);
        text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 30px var(--neon-blue);
    }

    .calculator-description {
        font-size: 1.2rem;
        text-align: center;
        color: var(--light-grey);
        margin-bottom: 2rem;
    }

    .input-section {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2rem;
    }

    .wage-input-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .toggle-container {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
        margin-right: 15px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: var(--accent-color);
        transition: .4s;
        border-radius: 34px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: var(--neon-blue);
    }

    input:checked + .slider:before {
        transform: translateX(26px);
    }

    #toggleLabel {
        font-size: 1rem;
        color: var(--light-text);
    }

    .input-group {
        margin-bottom: 15px;
    }

    .input-label {
        display: block;
        margin-bottom: 5px;
        color: var(--light-grey);
        font-size: 0.9rem;
    }

    .input-field {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--accent-color);
        border-radius: 5px;
        background-color: var(--secondary-color);
        color: var(--light-text);
        font-size: 1rem;
        transition: border-color 0.3s ease;
    }

    .input-field:focus {
        outline: none;
        border-color: var(--neon-blue);
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
    }

    .error-message {
        color: #ff4d4d;
        font-size: 0.8rem;
        margin-top: 5px;
        display: none;
    }

    @media (min-width: 768px) {
        #salaryHoursInputs, #hourlyWageInput {
            display: flex;
            gap: 20px;
        }

        .input-group {
            flex: 1;
        }
    }

    .hourly-wage {
        text-align: center;
        font-size: 1.2rem;
        margin-top: 1rem;
        color: var(--text-color);
    }

    .timer-section {
        text-align: center;
        margin-bottom: 2rem;
    }

    .poop-emoji {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    .poop-emoji.wiggle {
        animation: wiggle 0.5s infinite;
    }

    .timer-display {
        font-size: 3rem;
        font-weight: bold;
        color: var(--text-color);
        margin-bottom: 1rem;
    }

    .timer-button {
        padding: 15px 30px;
        font-size: 1.2rem;
        border: none;
        border-radius: 50px;
        background-color: var(--neon-blue);
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .timer-button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 15px var(--neon-blue);
    }

    .earnings-display {
        font-size: 1.2rem;
        color: var(--text-color);
        margin-top: 1rem;
        font-weight: bold;
    }

    .poop-log-section {
        text-align: center;
        max-height: 300px;
        overflow-y: auto;
    }

    .poop-log-title {
        font-size: 1.5rem;
        color: var(--light-grey);
        margin-bottom: 1rem;
    }

    .poop-log-placeholder {
        color: var(--light-grey);
        font-style: italic;
    }

    .log-entry {
        background-color: var(--secondary-color);
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: relative;
    }

    .log-entry p {
        margin: 5px 0;
    }

    .log-entry .log-date {
        font-weight: bold;
        color: var(--neon-blue);
    }

    .log-entry .log-duration,
    .log-entry .log-earnings,
    .log-entry .log-rating {
        color: var(--light-grey);
    }

    .delete-button {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: #ff4d4d;
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .delete-button:hover {
        background-color: #ff1a1a;
    }

    .card {
        background-color: rgba(22, 33, 62, 0.8);
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    @keyframes wiggle {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(-5deg); }
        75% { transform: rotate(5deg); }
        100% { transform: rotate(0deg); }
    }

    @media (max-width: 767px) {
        .tabs {
            flex-wrap: wrap;
        }

        .tab {
            flex: 1 0 25%;
            max-width: 25%;
        }

        .turd-token-balance {
            position: fixed;
            top: 10px;
            right: 10px;
            width: auto;
        }
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: var(--secondary-color);
        margin: 15% auto;
        padding: 20px;
        border: 1px solid var(--accent-color);
        width: 300px;
        border-radius: 10px;
        text-align: center;
    }

    .emoji-rating {
        font-size: 2rem;
        margin: 20px 0;
    }

    .poopEmoji {
        cursor: pointer;
        opacity: 0.5;
        transition: opacity 0.3s ease;
    }

    .poopEmoji:hover {
        opacity: 1;
    }

    #submitRatingButton {
        padding: 10px 20px;
        background-color: var(--neon-blue);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #submitRatingButton:hover {
        background-color: #2980b9;
    }

    .congrats-message {
        color: #4CAF50;
        font-weight: bold;
        margin-bottom: 15px;
        font-size: 1.1em;
    }

    #shareModal .modal-content {
        width: 400px;
    }

    #shareModal button {
        display: block;
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        background-color: var(--neon-blue);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    #shareModal button:hover {
        background-color: #2980b9;
    }

    #twitterShareButton {
        background-color: #1DA1F2;
    }

    #facebookShareButton {
        background-color: #4267B2;
    }

    #smsShareButton {
        background-color: #25D366;
    }

    #statisticsSection {
        margin-bottom: 20px;
    }

    .statistics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
        background: rgba(26, 26, 46, 0.4);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(52, 152, 219, 0.2);
    }

    .stat-card {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-card:before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            45deg,
            transparent,
            rgba(52, 152, 219, 0.1),
            transparent
        );
        transform: rotate(45deg);
        animation: shine 3s infinite;
    }

    .stat-card.featured {
        background: linear-gradient(145deg, rgba(52, 152, 219, 0.2), rgba(41, 128, 185, 0.2));
        border: 2px solid rgba(52, 152, 219, 0.5);
        padding: 30px;
    }

    .stat-card.featured p {
        font-size: 3.5rem;
        background: linear-gradient(45deg, #3498db, #2ecc71);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        margin-bottom: 10px;
    }

    .stat-card:not(.featured) p {
        font-size: 1.8rem;
        color: var(--text-color);
        text-shadow: 0 0 10px rgba(0, 206, 209, 0.5);
        margin-bottom: 5px;
    }

    .stat-card span {
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    @keyframes shine {
        0% {
            left: -100%;
        }
        20% {
            left: 100%;
        }
        100% {
            left: 100%;
        }
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3), 
                    0 0 15px rgba(52, 152, 219, 0.5);
    }

    #statsChart {
        background: rgba(26, 26, 46, 0.8);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(52, 152, 219, 0.2);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        backdrop-filter: blur(4px);
    }

    .date-range-controls {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(52, 152, 219, 0.2);
        backdrop-filter: blur(10px);
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }

    .quick-filter-btn {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        padding: 12px 24px;
        border-radius: 10px;
        color: var(--light-text);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .quick-filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        border-color: rgba(52, 152, 219, 0.6);
    }

    .quick-filter-btn.active {
        background: linear-gradient(145deg, var(--neon-blue), #2980b9);
        border-color: var(--neon-blue);
        box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
    }

    #startDate, #endDate {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        border-radius: 10px;
        padding: 12px;
        color: var(--light-text);
        transition: all 0.3s ease;
    }

    #startDate:focus, #endDate:focus {
        outline: none;
        border-color: var(--neon-blue);
        box-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
    }

    #filterStats, #resetStats {
        background: linear-gradient(145deg, rgba(22, 33, 62, 0.9), rgba(15, 52, 96, 0.9));
        border: 1px solid rgba(52, 152, 219, 0.3);
        border-radius: 10px;
        padding: 12px 24px;
        color: var(--light-text);
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    #filterStats {
        background: linear-gradient(145deg, var(--neon-blue), #2980b9);
    }

    #filterStats:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
    }

    #resetStats {
        background: linear-gradient(145deg, #e74c3c, #c0392b);
        border-color: #e74c3c;
    }

    #resetStats:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
    }

    .date-range-divider {
        color: var(--light-text);
        opacity: 0.7;
        font-size: 0.9em;
    }

    .date-range-header {
        color: var(--light-text);
        font-size: 1.2em;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
    }

    .game-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        padding: 20px;
    }

    .game-link {
        display: block;
        text-align: center;
    }

    .game-image {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
        transition: transform 0.3s ease;
    }

    .game-image:hover {
        transform: scale(1.05);
    }

    .confirm-dialog {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
    }

    .confirm-dialog-content {
        background-color: var(--secondary-color);
        border-radius: 10px;
        padding: 20px;
        width: 300px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }

    .confirm-dialog-buttons {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
    }

    .confirm-dialog button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .confirm-dialog .confirm {
        background-color: #ff4d4d;
        color: white;
    }

    .confirm-dialog .cancel {
        background-color: var(--neon-blue);
        color: white;
    }

    .confirm-dialog button:hover {
        transform: translateY(-2px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
 .popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.popup-content {
    background-color: #000;
    border: 1px solid #00ffff;
    padding: 20px;
    border-radius: 8px;
    width: 80%;
    max-width: 400px;
    text-align: center;
    color: #00ffff;
}

.close-btn {
    color: #00ffff;
    float: right;
    font-size: 1.5em;
    cursor: pointer;
    margin-top: -10px;
}

    .logout-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 20px;
    background: linear-gradient(145deg, var(--secondary-color), var(--accent-color));
    color: var(--light-text);
    border: 1px solid rgba(52, 152, 219, 0.3);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    z-index: 1000;
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    background: linear-gradient(145deg, var(--accent-color), var(--neon-blue));
}

    /* Container for share buttons */
.share-statistics {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 20px;
}

/* Base style for each share button */
.share-button {
    background-color: var(--secondary-color); /* Customizable background color */
    border: none;
    border-radius: 75%; /* Circular button style */
    width: 75px; /* Button size */
    height: 75px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    overflow: hidden;
}

/* Style for the custom icons within buttons */
.share-button img {
    width: 72px;
    height: 72px;
}

/* Hover effects for each specific button */
.share-button.twitter:hover {
    background-color: #1DA1F2; /* Twitter blue */
}

.share-button.facebook:hover {
    background-color: #4267B2; /* Facebook blue */
}

.share-button.sms:hover {
    background-color: #25D366; /* SMS green */
}

/* Optional: Additional hover animation and shadow */
.share-button:hover {
    transform: scale(1.1); /* Slightly enlarges button on hover */
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
}
    /* Ensure game and shop images are visible */
    .game-image, .shop-image {
        display: block !important;
        visibility: visible !important;
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let currentUser = null;
let annualSalaryInput;
let weeklyHoursInput;
let wageToggle;
let hourlyWageField;
let hourlyWageDisplay;
let hourlyWage = 0;

let stats = {
    totalSessions: 0,
    totalPoopTime: 0,
    totalEarnings: 0,
    firstSessionDate: null,
    lastSessionDate: null
};

let turdTokens = 0;
let lastAwardDate = null;

let timerInterval;
let seconds = 0;
let isTimerRunning = false;

function formatTime(totalSeconds) {
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
}

function updateHourlyWage() {
    if (wageToggle.checked) {
        hourlyWage = parseFloat(hourlyWageField.value) || 0;
    } else {
        const annualSalary = parseFloat(annualSalaryInput.value) || 0;
        const weeklyHours = parseFloat(weeklyHoursInput.value) || 0;
        
        if (weeklyHours > 0) {
            hourlyWage = (annualSalary / 52) / weeklyHours;
        } else {
            hourlyWage = 0;
        }
    }
    hourlyWageDisplay.textContent = `Your hourly wage: $${hourlyWage.toFixed(2)}`;
    saveUserData();
}

function loadUserData() {
    console.log("loadUserData is running...");
    
    const savedUser = JSON.parse(localStorage.getItem('currentUser'));
    const userData = savedUser?.data || savedUser;

    if (userData) {
        console.log("Loaded user data:", userData);

        // Log each field update
        hourlyWage = userData.hourlyWage || 0;
        console.log("Hourly Wage Set:", hourlyWage);

        annualSalaryInput.value = userData.annualSalary || '';
        console.log("Annual Salary Set:", annualSalaryInput.value);

        weeklyHoursInput.value = userData.weeklyHours || '';
        console.log("Weekly Hours Set:", weeklyHoursInput.value);

        hourlyWageField.value = userData.hourlyWageInput || '';
        console.log("Hourly Wage Input Set:", hourlyWageField.value);

        wageToggle.checked = userData.wageToggle || false;
        console.log("Wage Toggle Set:", wageToggle.checked);

        stats = userData.stats || { totalSessions: 0, totalPoopTime: 0, totalEarnings: 0 };
        console.log("Stats Set:", stats);

        turdTokens = userData.turdTokens || 0;
        console.log("Turd Tokens Set:", turdTokens);

        lastAwardDate = userData.lastAwardDate || null;
        console.log("Last Award Date Set:", lastAwardDate);

        // Set poop logs and verify
        if (userData.poopLogs && userData.poopLogs.length > 0) {
            poopLogPlaceholder.style.display = 'none';
            poopLog.innerHTML = userData.poopLogs.join('');
            console.log("Poop Logs Set:", poopLog.innerHTML);

            // Assign delete button event handlers to each log entry
            poopLog.querySelectorAll('.delete-button').forEach(button => {
                const logEntry = button.parentElement;
                const durationText = logEntry.querySelector('.log-duration').textContent;
                
                // Extract duration from the text (assuming format like "Duration: 1h 30m")
                const duration = parseInt(durationText.match(/\d+/g).reduce((acc, val) => acc * 60 + parseInt(val), 0));
                const earnings = parseFloat(logEntry.querySelector('.log-earnings').textContent.replace(/[^0-9.-]+/g, ''));

                // Assign confirmDelete function to the button click event
                button.onclick = () => confirmDelete(logEntry, duration, earnings);
            });
        }

        // Display and update UI elements
        displayStatistics();
        updateTurdTokenDisplay();
        updateHourlyWage();
    } else {
        console.log("No user data found in localStorage.");
    }
}


// Standardize `users` to ensure consistent format for each account
function standardizeUsersFormat() {
    const users = JSON.parse(localStorage.getItem('users') || '{}');
    Object.keys(users).forEach(email => {
        if (typeof users[email] === 'string') {
            users[email] = { password: users[email], data: {} };
        }
    });
    localStorage.setItem('users', JSON.stringify(users));
}

// Call to initialize format on page load
standardizeUsersFormat();

function saveUserData() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    const users = JSON.parse(localStorage.getItem('users') || '{}');

    if (currentUser) {
        // Ensure currentUser has an email property
        if (!currentUser.email) {
            currentUser.email = Object.keys(users).find(email => users[email].data === currentUser.data);
        }

        // Update data fields in currentUser, including poopLogs
        currentUser.data = {
            hourlyWage: hourlyWage,
            annualSalary: annualSalaryInput.value,
            weeklyHours: weeklyHoursInput.value,
            hourlyWageInput: hourlyWageField.value,
            wageToggle: wageToggle.checked,
            stats: stats,
            turdTokens: turdTokens,
            lastAwardDate: lastAwardDate,
            poopLogs: Array.from(poopLog.children).map(entry => entry.outerHTML)
        };

        // Sync currentUser and users to ensure data persistence
        localStorage.setItem('currentUser', JSON.stringify(currentUser));

        // Update users[currentUser.email] with the updated data
        if (currentUser.email && users[currentUser.email]) {
            users[currentUser.email].data = currentUser.data;
            localStorage.setItem('users', JSON.stringify(users));
        }
        console.log("Updated currentUser and users with poopLogs:", currentUser, users);
    }
}
    
function confirmDelete(logEntry, duration, earnings) {
    if (confirm("Are you sure you want to delete this log?")) {
        // Update stats before removing log
        stats.totalPoopTime -= duration;
        stats.totalEarnings -= earnings;
        stats.totalSessions--;

        logEntry.remove();
        saveUserData();
        displayStatistics();
    }
}


function checkLoginStatus() {
    if (!localStorage.getItem('currentUser')) {
        window.location.href = '/index.html';
    }
}

function isFirstSessionOfDay() {
    const today = new Date().toDateString();
    const lastAwardDay = lastAwardDate ? new Date(lastAwardDate).toDateString() : null;

    if (today !== lastAwardDay) {
        lastAwardDate = new Date().toISOString();
        saveUserData();
        showTokenAwardNotification(); // Ensure this is called
        return true;
    }
    return false;
}


function showTokenAwardNotification() {
    const ratingsBox = document.querySelector('.ratings-box'); // Ensure the class matches the correct ratings box in your HTML
    if (!ratingsBox) {
        console.warn("Ratings box not found");
        return;
    }
    
    const notification = document.createElement('div');
    notification.className = 'token-award-notification';
    notification.textContent = 'üéâ You earned 1 Turd Token for your first poop of the day!';
    ratingsBox.appendChild(notification);

    setTimeout(() => {
        notification.remove();
    }, 3000);
}


function updateTurdTokenDisplay() {
    const tokenDisplay = document.querySelector('.turd-token-balance span');
    if (tokenDisplay) {
        tokenDisplay.textContent = `TT: ${turdTokens}`;
    }
    localStorage.setItem('turdTokens', turdTokens);
}

 

function displayStatistics(filtered = false, filteredStats = null) {
    const statsToUse = filtered ? filteredStats : stats;
    const totalTime = statsToUse.totalPoopTime;
    const totalHours = Math.floor(totalTime / 3600);
    const totalMinutes = Math.floor((totalTime % 3600) / 60);
    const totalSecs = totalTime % 60;

    const avgPoopTime = statsToUse.totalSessions > 0 ? totalTime / statsToUse.totalSessions : 0;
    const avgHours = Math.floor(avgPoopTime / 3600);
    const avgMinutes = Math.floor((avgPoopTime % 3600) / 60);
    const avgSecs = Math.floor(avgPoopTime % 60);

    // Fix date calculation
    let totalDays = 1; // Default to 1 to avoid division by zero
    if (statsToUse.firstSessionDate && statsToUse.lastSessionDate) {
        const firstDate = new Date(statsToUse.firstSessionDate);
        const lastDate = new Date(statsToUse.lastSessionDate);
        const timeDiff = Math.abs(lastDate - firstDate);
        totalDays = Math.max(1, Math.ceil(timeDiff / (1000 * 60 * 60 * 24)));
    }
    
    const avgPoopsPerDay = (statsToUse.totalSessions / totalDays).toFixed(2);

    document.getElementById('totalSessions').textContent = statsToUse.totalSessions;
    document.getElementById('totalTime').textContent = `${String(totalHours).padStart(2, '0')}:${String(totalMinutes).padStart(2, '0')}:${String(totalSecs).padStart(2, '0')}`;
    document.getElementById('totalEarnings').textContent = `${statsToUse.totalEarnings.toFixed(2)}`;
    document.getElementById('avgPoopTime').textContent = `${String(avgHours).padStart(2, '0')}:${String(avgMinutes).padStart(2, '0')}:${String(avgSecs).padStart(2, '0')}`;
    document.getElementById('avgEarnings').textContent = `${(statsToUse.totalSessions > 0 ? statsToUse.totalEarnings / statsToUse.totalSessions : 0).toFixed(2)}`;
    document.getElementById('avgPoopsPerDay').textContent = avgPoopsPerDay;

    updateStatsChart(statsToUse);
}

function updateStatsChart(statsData) {
    const ctx = document.getElementById('statsChart').getContext('2d');
    
    if (window.statsBarChart) {
        window.statsBarChart.destroy();
    }

    window.statsBarChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Total Sessions', 'Avg Poops/Day', 'Total Hours', 'Avg Minutes/Poop', 'Total Earnings ($)'],
            datasets: [{
                label: 'Statistics',
                data: [
                    statsData.totalSessions,
                    parseFloat((statsData.totalSessions / Math.max(1, Math.ceil((statsData.lastSessionDate - statsData.firstSessionDate) / (1000 * 60 * 60 * 24)))).toFixed(2)),
                    Math.floor(statsData.totalPoopTime / 3600),
                    Math.floor((statsData.totalPoopTime / statsData.totalSessions / 60) || 0),
                    parseFloat(statsData.totalEarnings.toFixed(2))
                ],
                backgroundColor: [
                    'rgba(52, 152, 219, 0.6)',
                    'rgba(46, 204, 113, 0.6)',
                    'rgba(155, 89, 182, 0.6)',
                    'rgba(241, 196, 15, 0.6)',
                    'rgba(231, 76, 60, 0.6)'
                ],
                borderColor: [
                    'rgba(52, 152, 219, 1)',
                    'rgba(46, 204, 113, 1)',
                    'rgba(155, 89, 182, 1)',
                    'rgba(241, 196, 15, 1)',
                    'rgba(231, 76, 60, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#f1f1f1'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#f1f1f1'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}

function filterStatsByDateRange(startDate, endDate) {
    // Normalize start and end dates to YYYY-MM-DD
    const start = new Date(startDate);
    const end = new Date(endDate);

    const normalizeDate = (date) => {
        return date.toISOString().split('T')[0]; // Extract YYYY-MM-DD
    };

    const normalizedStart = normalizeDate(start);
    const normalizedEnd = normalizeDate(end);

    console.log(`Filtering logs between: ${normalizedStart} and ${normalizedEnd}`);

    // Initialize the filtered statistics object
    const filteredStats = {
        totalSessions: 0,
        totalPoopTime: 0,
        totalEarnings: 0,
        firstSessionDate: null,
        lastSessionDate: null
    };

    // Get all log entries from the DOM (assuming poopLog is a container element with log entries)
    const logEntries = Array.from(poopLog.children);

    // Iterate over each log entry to filter by date range
    logEntries.forEach((entry, index) => {
        const dateText = entry.querySelector('.log-date').textContent;
        const entryDate = new Date(dateText);
        const normalizedEntryDate = normalizeDate(entryDate);

        // Log the current entry being processed
        console.log(`Processing entry ${index + 1} with date: ${normalizedEntryDate}`);

        // Check if the log entry date falls within the specified date range (inclusive)
        if (normalizedEntryDate >= normalizedStart && normalizedEntryDate <= normalizedEnd) {
            console.log(`Entry ${index + 1} is within the date range.`);

            // Extract duration and convert to seconds
            const durationText = entry.querySelector('.log-duration').textContent;
            const [hours, minutes, seconds] = durationText.match(/\d+/g).map(Number);
            const totalSeconds = (hours * 3600) + (minutes * 60) + seconds;

            // Extract earnings and convert to a numerical value
            const earningsText = entry.querySelector('.log-earnings').textContent;
            const earnings = parseFloat(earningsText.replace(/[^0-9.-]+/g, ''));

            // Update filtered statistics
            filteredStats.totalSessions++;
            filteredStats.totalPoopTime += totalSeconds;
            filteredStats.totalEarnings += earnings;

            // Update first and last session dates
            if (!filteredStats.firstSessionDate || entryDate < filteredStats.firstSessionDate) {
                filteredStats.firstSessionDate = entryDate;
            }
            if (!filteredStats.lastSessionDate || entryDate > filteredStats.lastSessionDate) {
                filteredStats.lastSessionDate = entryDate;
            }
        } else {
            console.log(`Entry ${index + 1} is outside the date range.`);
        }
    });

    // Log final filtered statistics for debugging purposes
    console.log("Filtered Statistics:", filteredStats);

    // Display the filtered statistics
    displayStatistics(true, filteredStats);
}

function confirmDelete(logEntry, duration, earnings) {
    console.log('Delete button clicked'); // Log when the function is called
    console.log('Log entry:', logEntry); // Log the log entry being deleted
    console.log('Duration:', duration); // Log the duration of the entry
    console.log('Earnings:', earnings); // Log the earnings of the entry

    const confirmDialog = document.querySelector('.confirm-dialog');
    if (!confirmDialog) {
        console.log('Confirm dialog not found!');
        return;
    }
    confirmDialog.style.display = 'block';
    console.log('Confirm dialog displayed');
    
    const confirmButton = confirmDialog.querySelector('.confirm');
    const cancelButton = confirmDialog.querySelector('.cancel');
    console.log('Buttons located:', confirmButton, cancelButton);

    const handleDelete = () => {
        console.log('Confirmed delete'); // Log when the delete is confirmed

        stats.totalSessions--;
        stats.totalPoopTime -= duration;
        stats.totalEarnings -= earnings;

        logEntry.remove();
        console.log('Log entry removed from DOM');

        if (poopLog.children.length === 0) {
            document.getElementById('poopLogPlaceholder').style.display = 'block';
        }

        updateDateRangeStats();
        displayStatistics();
        saveUserData();
        confirmDialog.style.display = 'none';

        confirmButton.removeEventListener('click', handleDelete);
        cancelButton.removeEventListener('click', handleCancel);
    };

    const handleCancel = () => {
        console.log('Delete canceled'); // Log when the delete is canceled
        confirmDialog.style.display = 'none';

        confirmButton.removeEventListener('click', handleDelete);
        cancelButton.removeEventListener('click', handleCancel);
    };

    confirmButton.addEventListener('click', handleDelete);
    cancelButton.addEventListener('click', handleCancel);
}



function updateDateRangeStats() {
    if (stats.totalSessions === 0) {
        stats.firstSessionDate = null;
        stats.lastSessionDate = null;
    } else {
        const entries = Array.from(poopLog.children);
        if (entries.length > 0) {
            const dates = entries.map(entry => new Date(entry.querySelector('.log-date').textContent));
            stats.firstSessionDate = new Date(Math.min(...dates));
            stats.lastSessionDate = new Date(Math.max(...dates));
        }
    }
}

 function validateInputs() {
    let isValid = true;
    if (wageToggle.checked) {
        // Check hourly wage input
        if (!hourlyWageField.value) {
            document.getElementById('hourlyWageError').textContent = 'Please enter your hourly wage';
            document.getElementById('hourlyWageError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('hourlyWageError').style.display = 'none';
        }
    } else {
        // Check annual salary input
        if (!annualSalaryInput.value) {
            document.getElementById('salaryError').textContent = 'Please enter your annual salary';
            document.getElementById('salaryError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('salaryError').style.display = 'none';
        }
        // Check weekly hours input
        if (!weeklyHoursInput.value) {
            document.getElementById('hoursError').textContent = 'Please enter your weekly work hours';
            document.getElementById('hoursError').style.display = 'block';
            isValid = false;
        } else {
            document.getElementById('hoursError').style.display = 'none';
        }
    }
    return isValid;
}

function startTimer() {
    if (!validateInputs()) {
        return; // Stop the function if inputs are not valid
    }
    const timerButton = document.getElementById('timerButton');
    const timerDisplay = document.getElementById('timerDisplay');
    const earningsDisplay = document.getElementById('earningsDisplay');
    const poopEmoji = document.querySelector('.poop-emoji');

    if (!isTimerRunning) {
        isTimerRunning = true;
        timerButton.textContent = 'Stop Pooping';
        poopEmoji.classList.add('wiggle');

        // Check if it's the first session of the day to award a Turd Token
        if (isFirstSessionOfDay()) {
            turdTokens++; // Increment Turd Tokens
            updateTurdTokenDisplay(); // Update the display of Turd Tokens
            showTokenAwardNotification(); // Show a notification about the new Turd Token
        }

        timerInterval = setInterval(() => {
            seconds++;
            timerDisplay.textContent = formatTime(seconds);
            const earnings = ((hourlyWage / 3600) * seconds).toFixed(2);
            earningsDisplay.textContent = `Current earnings: $${earnings}`;
        }, 1000);
    } else {
        isTimerRunning = false;
        clearInterval(timerInterval);
        timerButton.textContent = 'Start Pooping';
        poopEmoji.classList.remove('wiggle');
        openRatingModal(); // Assume this handles ending the session and rating
        seconds = 0;
        timerDisplay.textContent = '00:00:00';
        earningsDisplay.textContent = '';
    }
}


function updateStatistics(duration, earnings) {
    stats.totalSessions++;
    stats.totalPoopTime += duration;
    stats.totalEarnings += parseFloat(earnings);

    const currentDate = new Date();
    if (!stats.firstSessionDate || currentDate < new Date(stats.firstSessionDate)) {
        stats.firstSessionDate = currentDate;
    }
    if (!stats.lastSessionDate || currentDate > new Date(stats.lastSessionDate)) {
        stats.lastSessionDate = currentDate;
    }

    displayStatistics();
    saveUserData();
}

document.addEventListener('DOMContentLoaded', () => {
    annualSalaryInput = document.getElementById('annualSalary');
    weeklyHoursInput = document.getElementById('weeklyHours');
    wageToggle = document.getElementById('wageToggle');
    hourlyWageField = document.getElementById('hourlyWageField');
    hourlyWageDisplay = document.getElementById('hourlyWage');

    annualSalaryInput.addEventListener('input', updateHourlyWage);
weeklyHoursInput.addEventListener('input', updateHourlyWage);
hourlyWageField.addEventListener('input', updateHourlyWage);
    
    const allTimeStatsBtn = document.getElementById('allTimeStats');
    const todayStatsBtn = document.getElementById('todayStats');
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    const filterButton = document.getElementById('filterStats');
    const resetButton = document.getElementById('resetStats');

    const ratingModal = document.getElementById('ratingModal');
    const congratsMessage = document.getElementById('congratsMessage');
    const poopEmojis = document.querySelectorAll('.poopEmoji');
    const submitRatingButton = document.getElementById('submitRatingButton');
    let selectedRating = 0;

    poopEmojis.forEach(emoji => {
        emoji.addEventListener('click', () => {
            selectedRating = parseInt(emoji.dataset.rating);
            poopEmojis.forEach((e, index) => {
                e.style.opacity = index < selectedRating ? '1' : '0.5';
            });
        });
    });

    submitRatingButton.addEventListener('click', () => {
    if (selectedRating > 0) {
        const latestEntry = poopLog.firstElementChild;
        if (latestEntry) {
            const ratingValue = latestEntry.querySelector('.rating-value');
            ratingValue.textContent = 'üí©'.repeat(selectedRating);
        }
        ratingModal.style.display = 'none';
        
        // Get the earnings from the latest poop log
        const earningsText = latestEntry.querySelector('.log-earnings').textContent;
        const earnings = parseFloat(earningsText.replace(/[^0-9.-]+/g, '')).toFixed(2);

        // Show the share modal with accurate earnings
        openShareModal(earnings, selectedRating);
    }
});


function openShareModal(earnings, rating) {
    const ratingText = rating > 0 ? 'üí©'.repeat(rating) : '';
    const message = `I just had a ${ratingText}-poop and earned $${earnings}! Find out how much you make to poop at www.poopprofit.com!`;

    const shareModal = document.getElementById('shareModal');
    shareModal.style.display = 'block';

    // Set up event listeners for the sharing buttons
    document.getElementById('twitterShareButton').onclick = () => shareOnTwitter(message);
    document.getElementById('facebookShareButton').onclick = () => shareOnFacebook(message);
    document.getElementById('smsShareButton').onclick = () => shareViaSMS(message);
}

function shareOnTwitter(message) {
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}`;
    window.open(twitterUrl, '_blank');
}

function shareOnFacebook(message) {
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://www.poopprofit.com')}&quote=${encodeURIComponent(message)}`;
    window.open(facebookUrl, '_blank');
}

function shareViaSMS(message) {
    window.open(`sms:?&body=${encodeURIComponent(message)}`);
}

    checkLoginStatus();
    lastAwardDate = localStorage.getItem('lastAwardDate');
    turdTokens = parseInt(localStorage.getItem('turdTokens')) || 0;
    updateTurdTokenDisplay();
    
    wageToggle.addEventListener('change', function() {
        if (this.checked) {
            salaryHoursInputs.style.display = 'none';
            hourlyWageInput.style.display = 'block';
            toggleLabel.textContent = 'Hourly Wage';
        } else {
            salaryHoursInputs.style.display = 'block';
            hourlyWageInput.style.display = 'none';
            toggleLabel.textContent = 'Salary & Hours';
        }
        updateHourlyWage();
    });

    const timerButton = document.getElementById('timerButton');
    timerButton.addEventListener('click', startTimer);

    todayStatsBtn.addEventListener('click', () => {
        clearActiveFilters();
        todayStatsBtn.classList.add('active');
        filterStatsByDay(new Date());
    });

    allTimeStatsBtn.addEventListener('click', () => {
        clearActiveFilters();
        allTimeStatsBtn.classList.add('active');
        displayStatistics();
    });

    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const tabId = tab.getAttribute('data-tab');
            const activeContent = document.querySelector('.tab-content.active');
            const newContent = document.getElementById(`${tabId}Tab`);

            activeContent.classList.add('fade-out');

            setTimeout(() => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active', 'fade-out'));
                
                tab.classList.add('active');
                newContent.classList.add('active', 'fade-out');

                void newContent.offsetWidth;

                newContent.classList.remove('fade-out');
            }, 300); 
        });
    });

    function filterStatsByDay(date) {
    // Set the start and end of the day for the given date
    const startOfDay = new Date(date);
    startOfDay.setHours(0, 0, 0, 0); // Start of the day (00:00:00.000)

    const endOfDay = new Date(date);
    endOfDay.setHours(23, 59, 59, 999); // End of the day (23:59:59.999)

    // Log start and end times for debugging
    console.log("Filtering stats for the day:", date);
    console.log("Start of Day:", startOfDay);
    console.log("End of Day:", endOfDay);

    // Call filterStatsByDateRange to filter logs for the specific day
    filterStatsByDateRange(startOfDay, endOfDay);
}


    filterButton.addEventListener('click', () => {
        const startDate = startDateInput.value;
        const endDate = endDateInput.value;
        if (startDate && endDate) {
            filterStatsByDateRange(startDate, endDate);
        } else {
            alert('Please select both start and end dates.');
        }
    });

    resetButton.addEventListener('click', () => {
        clearActiveFilters();
        displayStatistics();
    });

    loadUserData();
    updateHourlyWage();
    displayStatistics();

    const turdTokenBalance = document.getElementById('turdTokenBalance');
    const turdTokenWallet = document.getElementById('turdTokenWallet');
    const walletBalance = document.getElementById('walletBalance');

    turdTokenBalance.addEventListener('click', () => {
        turdTokenWallet.style.display = 'block';
        walletBalance.textContent = turdTokens;
    });

    turdTokenWallet.querySelector('.close').addEventListener('click', () => {
        turdTokenWallet.style.display = 'none';
    });

    window.onclick = function(event) {
        if (event.target == ratingModal) {
            ratingModal.style.display = "none";
        }
        if (event.target == document.getElementById('shareModal')) {
            document.getElementById('shareModal').style.display = 'none';
        }
        if (event.target == document.getElementById('turdTokenWallet')) {
            document.getElementById('turdTokenWallet').style.display = 'none';
        }
        if (event.target == document.querySelector('.confirm-dialog')) {
            document.querySelector('.confirm-dialog').style.display = 'none';
        }
    }
});

function shareStatisticsOnTwitter() {
    const statsText = getShareableStats();
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(statsText)}`;
    window.open(twitterUrl, '_blank');
}

function shareStatisticsOnFacebook() {
    const statsText = getShareableStats();
    const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://www.poopprofit.com')}&quote=${encodeURIComponent(statsText)}`;
    window.open(facebookUrl, '_blank');
}

function shareStatisticsViaSMS() {
    const statsText = getShareableStats();
    window.open(`sms:?&body=${encodeURIComponent(statsText)}`);
}

function getShareableStats() {
    return `My Poop Profit Stats:
Total Poops at Work: ${stats.totalSessions}
Total I've Got Paid to Poop: $${stats.totalEarnings.toFixed(2)}
Average Earnings Per Poop: $${(stats.totalEarnings / stats.totalSessions || 0).toFixed(2)}
Find out how much YOU get paid to poop at www.poopprofit.com!`;
}

function clearActiveFilters() {
    document.getElementById('allTimeStats').classList.remove('active');
    document.getElementById('todayStats').classList.remove('active');
    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';
}

function openRatingModal() {
    const ratingModal = document.getElementById('ratingModal');
    const congratsMessage = document.getElementById('congratsMessage');
    const poopEmojis = document.querySelectorAll('.poopEmoji');
    
    const earnings = ((hourlyWage / 3600) * seconds).toFixed(2);
    congratsMessage.textContent = `Congratulations! You just earned $${earnings}!`;
    
    ratingModal.style.display = 'block';
    selectedRating = 0;
    
    poopEmojis.forEach(emoji => {
        emoji.style.opacity = '0.5';
    });

    if (isFirstSessionOfDay()) {
        turdTokens++;
        updateTurdTokenDisplay();
        showTokenAwardNotification();
    }

    const currentDate = new Date().toLocaleString();
    const logEntry = document.createElement('div');
    logEntry.className = 'log-entry';
    logEntry.innerHTML = `
        <button class="delete-button">√ó</button>
        <p class="log-date">${currentDate}</p>
        <p class="log-duration">Duration: ${formatTime(seconds)}</p>
        <p class="log-earnings">Earnings: $${earnings}</p>
        <p class="log-rating">Rating: <span class="rating-value">Not rated</span></p>
    `;

    // Assign delete button event handler
    const deleteButton = logEntry.querySelector('.delete-button');
    deleteButton.onclick = () => confirmDelete(logEntry, seconds, parseFloat(earnings));

    if (poopLog.children.length === 0) {
        poopLogPlaceholder.style.display = 'none';
    }
    
    poopLog.insertBefore(logEntry, poopLog.firstChild);
    updateStatistics(seconds, earnings);
}

</script>
</head>
<body>
<div class="app-container">
    <header>
        <img src="https://www.poopprofit.com/BANNER.jpeg" alt="Poop Profit Header" class="header-image">
    </header>
    <main>
        <div class="interface-container">
            <div class="turd-token-balance" id="turdTokenBalance">
                <img src="https://www.poopprofit.com/Turdtoken.png" alt="Turd Token" class="turd-token-icon">
                <span>TT: 1</span>
            </div>
            <div class="tabs">
                <button class="tab active" data-tab="calculator">
                    <img src="https://www.poopprofit.com/calc.png" alt="Calculator" class="tab-icon">
                </button>
                <button class="tab" data-tab="statistics">
                    <img src="https://www.poopprofit.com/stats.png" alt="Bathroom Game 2" class="tab-icon">
                </button>
                <button class="tab" data-tab="games">
                    <img src="https://www.poopprofit.com/games.png" alt="Statistics" class="tab-icon">
                </button>
                <button class="tab" data-tab="shop">
                    <img src="https://www.poopprofit.com/shop.png" alt="Shop" class="tab-icon">
                </button>
            </div>

            <div class="tab-content-container">
                <div id="shopTab" class="tab-content">
                    <img src="https://www.poopprofit.com/Storecomingsoon.png" alt="Shop Items Coming Soon" class="shop-image" style="display: block; margin: 0 auto; max-width: 100%; height: auto;">
                </div><div id="gamesTab" class="tab-content">
                    <h2></h2>
                    <div class="game-grid">
                        <a href="/TurdToTheMoon.html" class="game-link" target="_blank">
                            <img src="https://www.poopprofit.com/Screenshot_20241017_202614.jpg" alt="Bathroom Game 1" class="game-image">
                        </a>
                        <a href="/TurdRaceGame.html" class="game-link" target="_blank">
                            <img src="https://www.poopprofit.com/Screenshot_20241017_202104.jpg" alt="Bathroom Game 3" class="game-image">
                        </a>
                        <a href="#game2" class="game-link" target="_blank">
                            <img src="https://www.poopprofit.com/Screenshot_20241017_202832.jpg" alt="Bathroom Game 2" class="game-image">
                        </a>
                    </div>
                </div><div id="calculatorTab" class="tab-content active">
                    <div class="calculator-container">
                        <h1 class="calculator-title">Poop Profit Calculator</h1>
                        <p class="calculator-description">Calculate how much money you make while pooping at work!</p>

                        <div class="input-section card">
                            <div class="wage-input-container">
                                <div class="toggle-container">
                                    <label class="switch">
                                        <input type="checkbox" id="wageToggle">
                                        <span class="slider round"></span>
                                    </label>
                                    <span id="toggleLabel">Salary &amp; Hours</span>
                                </div>
                                <div id="salaryHoursInputs">
                                    <div class="input-group">
                                        <label for="annualSalary" class="input-label">Annual Salary</label>
                                        <input type="number" id="annualSalary" class="input-field" placeholder="Enter your annual salary">
                                        <span id="salaryError" class="error-message"></span>
                                    </div>
                                    <div class="input-group">
                                        <label for="weeklyHours" class="input-label">Weekly Work Hours</label>
                                        <input type="number" id="weeklyHours" class="input-field" placeholder="Enter your weekly work hours">
                                        <span id="hoursError" class="error-message"></span>
                                    </div>
                                </div>
                                <div id="hourlyWageInput" style="display: none;">
                                    <div class="input-group">
                                        <label for="hourlyWageField" class="input-label">Hourly Wage</label>
                                        <input type="number" id="hourlyWageField" class="input-field" placeholder="Enter your hourly wage">
                                        <span id="hourlyWageError" class="error-message"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hourly-wage" id="hourlyWage">Your hourly wage: $250.00</div>

                        <div class="timer-section card">
                            <div class="poop-emoji">üí©</div>
                            <div class="timer-display" id="timerDisplay">00:00:00</div>
                            <button class="timer-button" id="timerButton">Start Pooping</button>
                            <div class="earnings-display" id="earningsDisplay"></div>
                        </div>

                        <div class="poop-log-section card">
                            <h2 class="poop-log-title">Poop Log</h2>
                            <p class="poop-log-placeholder" id="poopLogPlaceholder" style="display: none;">No poop sessions logged yet!</p>
                            <div id="poopLog"><div class="log-entry">
        <button class="delete-button">√ó</button>
        <p class="log-date">11/5/2024, 4:30:27 AM</p>
        <p class="log-duration">Duration: 00:00:01</p>
        <p class="log-earnings">Earnings: $0.07</p>
        <p class="log-rating">Rating: <span class="rating-value">Not rated</span></p>
    </div><div class="log-entry">
        <button class="delete-button">√ó</button>
        <p class="log-date">11/5/2024, 4:30:22 AM</p>
        <p class="log-duration">Duration: 00:00:02</p>
        <p class="log-earnings">Earnings: $0.14</p>
        <p class="log-rating">Rating: <span class="rating-value">üí©üí©üí©üí©üí©</span></p>
    </div></div>
                        </div>
                    </div>
                </div>

                <div id="statisticsTab" class="tab-content">
                    <h2></h2>
                    <div class="date-range-header">View Statistics By</div>
                    <div class="date-range-controls">
                        <button id="allTimeStats" class="quick-filter-btn">All Time</button>
                        <button id="todayStats" class="quick-filter-btn">Today</button>
                        <div class="date-range-divider">or</div>
                        <input type="date" id="startDate" placeholder="Start Date">
                        <input type="date" id="endDate" placeholder="End Date">
                        <button id="filterStats">Filter Range</button>
                        <button id="resetStats">Reset</button>
                    </div>
                    <div id="statisticsSection" class="statistics-grid">
                        <div class="stat-card featured" style="grid-column: 1 / -1; margin-bottom: 20px;">
    <p id="totalEarnings">0.21</p>
    <span>Total Earnings</span>
</div>
                        <div class="stat-card">
                            <p id="totalSessions">2</p>
                            <span>Total Sessions</span>
                        </div>
                        <div class="stat-card">
                            <p id="totalTime">00:00:05</p>
                            <span>Total Time</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgPoopTime">00:00:02</p>
                            <span>Avg Poop Time</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgEarnings">0.11</p>
                            <span>Avg Earnings</span>
                        </div>
                        <div class="stat-card">
                            <p id="avgPoopsPerDay">2.00</p>
                            <span>Avg Poops/Day</span>
                        </div>
                    </div>
                    <canvas id="statsChart" width="1063" height="797" style="margin-top: 20px; display: block; box-sizing: border-box; height: 797px; width: 1063px;"></canvas>
                    <div class="share-statistics">
    <button class="share-button twitter" onclick="shareStatisticsOnTwitter()">
        <img src="https://www.poopprofit.com/xicon.png" alt="Twitter Icon">
    </button>
    <button class="share-button facebook" onclick="shareStatisticsOnFacebook()">
        <img src="https://www.poopprofit.com/fbicon.png" alt="Facebook Icon">
    </button>
    <button class="share-button sms" onclick="shareStatisticsViaSMS()">
        <img src="https://www.poopprofit.com/txticon.png" alt="SMS Icon">
    </button>
</div>

                

                
            </div>
        </div>
    </div></main>
</div>

<div id="ratingModal" class="modal">
    <div class="modal-content">
        <p id="congratsMessage" class="congrats-message"></p>
        <h2>Rate Your Poop Session</h2>
        <div class="emoji-rating">
            <span class="poopEmoji" data-rating="1">üí©</span>
            <span class="poopEmoji" data-rating="2">üí©</span>
            <span class="poopEmoji" data-rating="3">üí©</span>
            <span class="poopEmoji" data-rating="4">üí©</span>
            <span class="poopEmoji" data-rating="5">üí©</span>
        </div>
        <button id="submitRatingButton">Submit Rating</button>
    </div>
</div>

<div id="shareModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="document.getElementById('shareModal').style.display='none'">√ó</span>
        <h2>Share Your Earnings!</h2>
        <button id="twitterShareButton">Share on Twitter</button>
        <button id="facebookShareButton">Share on Facebook</button>
        <button id="smsShareButton">Share via SMS</button>
    </div>
</div>

<div class="confirm-dialog">
    <div class="confirm-dialog-content">
        <p>Are you sure you want to delete this log entry?</p>
        <div class="confirm-dialog-buttons">
            <button class="confirm">Yes, delete</button>
            <button class="cancel">Cancel</button>
        </div>
    </div>
</div>

<div id="turdTokenWallet" class="modal">
    <div class="modal-content">
        <span class="close">√ó</span>
        <h2>Turd Token Wallet</h2>
        <div class="wallet-content">
            <img src="https://www.poopprofit.com/Turdtoken.png" alt="Turd Token" class="wallet-token-icon" style="width: 64px; height: 64px; margin: 10px auto; display: block;">
            <p>Balance: <span id="walletBalance">0</span> TT</p>
        </div>
        <p style="text-align: center; margin-top: 20px; font-style: italic;">COMING SOON</p>
    </div>
</div>
<!-- Popup HTML -->
<div id="gamesPopup" class="popup" style="display: none;">
    <div class="popup-content">
        <span class="close-btn" onclick="closePopup()">√ó</span>
        <p>Turd Token Wallet Coming Soon! For now, only demo tokens are available for all games.</p>
    </div>
</div>

<!-- JavaScript for Popup -->
<script>
    function showPopup() {
        document.getElementById("gamesPopup").style.display = "flex";
    }

    function closePopup() {
        document.getElementById("gamesPopup").style.display = "none";
    }

    // Trigger popup when "Games" tab is clicked
    document.querySelector('.tab[data-tab="games"]').addEventListener("click", function(event) {
        event.preventDefault(); // Prevents any default behavior
        showPopup();
    });
 // Clear `currentUser` on logout
function logout() {
    localStorage.removeItem('currentUser');
    window.location.href = '/loggedout.html'; // Redirect to login page
}
</script>

<button class="logout-btn" onclick="logout()">Logout</button>

</body></html>
