<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Have you ever wondered how much you make to poop at work?" />
    <meta name="keywords" content="poop tracker, earnings tracker, poop earnings, fun poop tracking, poop profit, profit calculator, work app, paid to poop, on the clock, poop at work, free money, work poop, poop on the job, poop earnings">
    <link rel="icon" href="https://www.poopprofit.com/favicon.png" type="image/png">
    <title>Poop Profit - Login/Sign-Up!</title>

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Poop Profit Calculator!" />
    <meta name="twitter:description" content="Have you ever wondered how much you make to poop at work?" />
    <meta name="twitter:image" content="https://raw.githubusercontent.com/Johnkay22/Loginpooptracker/main/PPCImage.jpg" />
    <meta name="twitter:site" content="@YourTwitterHandle" />

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Poop Profit Calculator!" />
    <meta property="og:description" content="Have you ever wondered how much you make to poop at work?" />
    <meta property="og:url" content="https://www.poopprofit.com" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Poop Profit Calculator" />
    <meta property="og:image" content="https://raw.githubusercontent.com/Johnkay22/Loginpooptracker/main/PPCImage.jpg">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>

    <!-- Firebase Initialization -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAVZEGrBqPtDWH4acfOmzLk5k323A7EB6o",
  authDomain: "poopprofitproject.firebaseapp.com",
  projectId: "poopprofitproject",
  storageBucket: "poopprofitproject.appspot.com",
  messagingSenderId: "818996284466",
  appId: "1:818996284466:web:de6d6bab3987cca417c02b",
  measurementId: "G-JBXJ1T6LYM"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Make `auth` and `db` globally accessible
        window.auth = firebase.auth();
        window.db = firebase.firestore();
    </script>

    <!-- CSS Stylesheet -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Page Content -->
    <div class="container">
        <h1>Welcome to Poop Profit</h1>
        <div class="form-container">
            <div class="register-section">
                <h2>Register</h2>
                <input type="email" id="registerEmail" placeholder="Email">
                <input type="password" id="registerPassword" placeholder="Password">
                <input type="password" id="confirmPassword" placeholder="Confirm Password">
                <button id="registerButton">Register</button>
                <p id="registerErrorMessage" style="color: red;"></p>
            </div>

            <div class="login-section">
                <h2>Login</h2>
                <input type="email" id="loginEmail" placeholder="Email">
                <input type="password" id="loginPassword" placeholder="Password">
                <button id="loginButton">Login</button>
                <p id="loginErrorMessage" style="color: red;"></p>
            </div>

            <div id="google-signin-section">
                <button id="googleSignInButton" class="button">Sign in with Google</button>
            </div>

            <p id="errorMessage" style="color: red;"></p>
        </div>
    </div>

    <!-- JavaScript Code for Registration, Login, and Google Sign-In -->
    <script>
        window.onload = function() {
            // Event Listeners for Registration, Login, and Google Sign-In
            document.getElementById('registerButton').addEventListener('click', register);
            document.getElementById('loginButton').addEventListener('click', login);
            document.getElementById('googleSignInButton').addEventListener('click', googleSignIn);
        };

        // Registration Function
        async function register() {
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const confirmPassword = document.getElementById('confirmPassword').value.trim();
            const errorMessage = document.getElementById('registerErrorMessage');

            if (!email || !password || password !== confirmPassword) {
                errorMessage.textContent = 'Please fill in all fields and ensure passwords match.';
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Save initial user data to Firestore
                await db.collection('users').doc(user.uid).set({
                    email: user.email,
                    poopSessions: [],
                    totalEarnings: 0,
                    salary: 0,
                    hoursPerWeek: 0
                });

                // Redirect to main page after successful registration
                window.location.href = 'https://www.poopprofit.com/main.html';
            } catch (error) {
                errorMessage.textContent = error.message;
            }
        }

        // Login Function
        async function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const errorMessage = document.getElementById('loginErrorMessage');

            if (!email || !password) {
                errorMessage.textContent = 'Please enter both email and password.';
                return;
            }

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Redirect to main page after successful login
                window.location.href = 'https://www.poopprofit.com/main.html';
            } catch (error) {
                errorMessage.textContent = error.message;
            }
        }

        // Google Sign-In Function
        async function googleSignIn() {
            const provider = new firebase.auth.GoogleAuthProvider();

            try {
                // Sign in user with Google
                const result = await auth.signInWithPopup(provider);
                const user = result.user;

                // Check if user data already exists in Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (!userDoc.exists) {
                    // If the user is new, save initial data to Firestore
                    await db.collection('users').doc(user.uid).set({
                        email: user.email,
                        poopSessions: [],
                        totalEarnings: 0,
                        salary: 0,
                        hoursPerWeek: 0
                    });
                }

                // Redirect to the main page after successful Google sign-in
                window.location.href = 'https://www.poopprofit.com/main.html';
            } catch (error) {
                console.error(error);
                document.getElementById('errorMessage').textContent = 'Google Sign-In failed. Please try again.';
            }
        }
    </script>

</body>
</html>
